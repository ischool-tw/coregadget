// Generated by CoffeeScript 1.3.3
(function() {
  var getAcademic, getAttendance, getDiscipline, getMorality, global, resetData, setBaseInfo;

  global = {};

  $(function() {
    var resetStudentList;
    gadget.autofit(document.getElementById("widget"));
    gadget.onSizeChanged(function(size) {
      $("#student-list").height(size.height - 125);
      $("#baseinfo").height(size.height - 95);
      $("#academic").height(size.height - 95);
      return $("#behavior").height(size.height - 95);
    });
    $("#filter-keyword").keyup(function() {
      return resetStudentList();
    });
    $("#filter-student").click(function() {
      return resetStudentList();
    });
    resetStudentList = function() {
      var accordionHTML, className, firstClassName, items;
      resetData();
      className = "";
      items = [];
      accordionHTML = "";
      firstClassName = "";
      global.students.each(function(index, student) {
        if (this.StudentName.indexOf($("#filter-keyword").val()) !== -1) {
          if (this.ClassName !== className) {
            className = this.ClassName;
            if (accordionHTML != null) {
              accordionHTML += items.join("");
              accordionHTML += "      </ul>\n    </div>\n  </div>\n</div>";
              items.splice(0);
            }
            accordionHTML += "<div class='accordion-group'>\n  <div class='accordion-heading my-nav-header'>\n    <a class='accordion-toggle' data-toggle='collapse' data-parent='#student-list' href='#collapse" + index + "'><i class='icon-user'></i>" + this.ClassName + "</a>\n  </div>\n  <div id='collapse" + index + "' class='accordion-body collapse " + (firstClassName === '' ? 'in' : '') + "'>\n    <div class='accordion-inner'>\n      <ul class='nav nav-tabs nav-stacked'>";
            if (firstClassName === '') {
              firstClassName = this.ClassName;
            }
          }
          return items.push("<li>\n  <a href='#' student-index='" + index + "'>\n    <span class='my-seat-no label label-inverse my-label'>" + this.SeatNo + "</span>\n    <span class='my-student-name'>" + this.StudentName + "</span>								\n    <span class='my-student-number'>" + this.StudentNumber + "</span>\n    <i class='icon-chevron-right pull-right icon-white'></i>\n  </a>\n</li>");
        }
      });
      accordionHTML += items.join("");
      accordionHTML += "      </ul>\n    </div>\n  </div>\n</div>";
      $("#student-list").html(accordionHTML);
      return $("#student-list .accordion-body a").click(function(e) {
        e.preventDefault();
        $(this).tab("show");
        $("#student-list .accordion-body a i").addClass("icon-white");
        $(this).find("i").removeClass("icon-white");
        global.student = global.students[$(this).attr("student-index")];
        resetData();
        setBaseInfo();
        getAcademic();
        getMorality();
        getAttendance();
        return getDiscipline();
      });
    };
    $("#editModal").modal({
      show: false
    });
    $("#editModal").on("hidden", function() {
      return $("#editModal #errorMessage").html("");
    });
    $("#editModal #save-data").click(function() {
      var edit_target, request, request_udt;
      request = "";
      request_udt = "";
      edit_target = $(this).attr("edit-target");
      if (edit_target === "phone") {
        request = "<Request>\n  <StudentInfo>\n    <StudentID>" + global.student.StudentID + "</StudentID>\n    <ContactPhone>" + ($('#editModal #contact-phone').val()) + "</ContactPhone>\n    <PermanentPhone>" + ($('#editModal #permanent-phone').val()) + "</PermanentPhone>\n    <SMSPhone>" + ($('#editModal #sms-phone').val()) + "</SMSPhone>\n  </StudentInfo>\n</Request>";
      }
      if (edit_target === "address") {
        request = "<Request>\n  <StudentInfo>\n    <StudentID>" + global.student.StudentID + "</StudentID>\n    <MailingAddress>\n      <AddressList>\n        <Address>\n          <ZipCode>" + ($('#editModal #contact-zip-code').val()) + "</ZipCode>\n          <County>" + ($('#editModal #contact-county').val()) + "</County>\n          <Town>" + ($('#editModal #contact-town').val()) + "</Town>\n          <DetailAddress>" + ($('#editModal #contact-detail').val()) + "</DetailAddress>\n        </Address>\n      </AddressList>\n    </MailingAddress>\n    <PermanentAddress>\n      <AddressList>\n        <Address>\n          <ZipCode>" + ($('#editModal #permanent-zip-code').val()) + "</ZipCode>\n          <County>" + ($('#editModal #permanent-county').val()) + "</County>\n          <Town>" + ($('#editModal #permanent-town').val()) + "</Town>\n          <DetailAddress>" + ($('#editModal #permanent-detail').val()) + "</DetailAddress>\n        </Address>\n      </AddressList>\n    </PermanentAddress>\n  </StudentInfo>\n</Request>";
      }
      if (edit_target === "message") {
        request = "<Request>\n  <StudentInfo>\n    <StudentID>" + global.student.StudentID + "</StudentID>\n    <Email>" + ($('#editModal #email').val()) + "</Email>\n  </StudentInfo>\n</Request>";
        request_udt = "<Request>\n  <StudentInfo>\n    <StudentID>" + global.student.StudentID + "</StudentID>\n    <FacebookID>" + ($('#editModal #facebook').val()) + "</FacebookID>\n    <SkypeID>" + ($('#editModal #skype').val()) + "</SkypeID>\n  </StudentInfo>\n</Request>";
      }
      if (edit_target === "emergency-contact") {
        request_udt = "<Request>\n  <StudentInfo>\n    <StudentID>" + global.student.StudentID + "</StudentID>\n    <EmergencyContactName>" + ($('#editModal #name').val()) + "</EmergencyContactName>\n    <EmergencyContactRelationship>" + ($('#editModal #relationship').val()) + "</EmergencyContactRelationship>\n    <EmergencyContactTel>" + ($('#editModal #phone').val()) + "</EmergencyContactTel>\n  </StudentInfo>\n</Request>";
      }
      if (edit_target === "custodian-info") {
        request = "<Request>\n  <StudentInfo>\n    <StudentID>" + global.student.StudentID + "</StudentID>\n    <CustodianName>" + ($('#editModal #name').val()) + "</CustodianName>\n    <CustodianRelationship>" + ($('#editModal #relationship').val()) + "</CustodianRelationship>\n    <CustodianOtherInfo>\n      <CustodianOtherInfo>\n        <Relationship>" + ($('#editModal #relationship').val()) + "</Relationship>\n        <Phone>" + ($('#editModal #phone').val()) + "</Phone>\n        <Email>" + ($('#editModal #email').val()) + "</Email>\n        <Job>" + ($('#editModal #job').val()) + "</Job>\n        <EducationDegree>" + ($('#editModal #education').val()) + "</EducationDegree>\n      </CustodianOtherInfo>\n    </CustodianOtherInfo>\n  </StudentInfo>\n</Request>";
      }
      if (edit_target === "father-info") {
        request = "<Request>\n  <StudentInfo>\n    <StudentID>" + global.student.StudentID + "</StudentID>\n    <FatherName>" + ($('#editModal #name').val()) + "</FatherName>\n    <FatherOtherInfo>\n      <FatherOtherInfo>\n        <Relationship>父</Relationship>\n        <Phone>" + ($('#editModal #phone').val()) + "</Phone>\n        <Email>" + ($('#editModal #email').val()) + "</Email>\n        <Job>" + ($('#editModal #job').val()) + "</Job>\n        <EducationDegree>" + ($('#editModal #education').val()) + "</EducationDegree>\n      </FatherOtherInfo>\n    </FatherOtherInfo>\n  </StudentInfo>\n</Request>";
      }
      if (edit_target === "mother-info") {
        request = "<Request>\n  <StudentInfo>\n    <StudentID>" + global.student.StudentID + "</StudentID>\n    <MotherName>" + ($('#editModal #name').val()) + "</MotherName>\n    <MotherOtherInfo>\n      <MotherOtherInfo>\n        <Relationship>父</Relationship>\n        <Phone>" + ($('#editModal #phone').val()) + "</Phone>\n        <Email>" + ($('#editModal #email').val()) + "</Email>\n        <Job>" + ($('#editModal #job').val()) + "</Job>\n        <EducationDegree>" + ($('#editModal #education').val()) + "</EducationDegree>\n      </MotherOtherInfo>\n    </MotherOtherInfo>\n  </StudentInfo>\n</Request>";
      }
      if (request !== "") {
        return gadget.getContract("ischool.addressbook").send({
          service: "addressbook.UpdateStudentInfo",
          body: request,
          result: function(response, error, xhr) {
            if (error != null) {
              return $("#editModal #errorMessage").html("<div class='alert alert-error'>\n  <button class='close' data-dismiss='alert'>×</button>\n  <strong>呼叫服務失敗或網路異常，請稍候重試!</strong>\n</div>");
            } else {
              if (response.Result.ExecuteCount === "1") {
                if (edit_target === "phone") {
                  global.student.ContactPhone = $('#editModal #contact-phone').val();
                  global.student.PermanentPhone = $('#editModal #permanent-phone').val();
                  global.student.SMSPhone = $('#editModal #sms-hone').val();
                }
                if (edit_target === "address") {
                  global.student.MailingAddress = {
                    AddressList: {
                      Address: {
                        ZipCode: $('#editModal #contact-zip-code').val(),
                        County: $('#editModal #contact-county').val(),
                        Town: $('#editModal #contact-town').val(),
                        DetailAddress: $('#editModal #contact-detail').val()
                      }
                    }
                  };
                  global.student.PermanentAddress = {
                    AddressList: {
                      Address: {
                        ZipCode: $('#editModal #permanent-zip-code').val(),
                        County: $('#editModal #permanent-county').val(),
                        Town: $('#editModal #permanent-town').val(),
                        DetailAddress: $('#editModal #permanent-detail').val()
                      }
                    }
                  };
                }
                if (edit_target === "message") {
                  global.student.EmailAddress = $('#editModal #email').val();
                }
                if (edit_target === "custodian-info") {
                  global.student.CustodianName = $('#editModal #name').val();
                  global.student.CustodianRelationship = $('#editModal #relationship').val();
                  global.student.CustodianOtherInfo = {
                    CustodianOtherInfo: {
                      Relationship: $('#editModal #relationship').val(),
                      Phone: $('#editModal #phone').val(),
                      Email: $('#editModal #email').val(),
                      Job: $('#editModal #job').val(),
                      EducationDegree: $('#editModal #education').val()
                    }
                  };
                }
                if (edit_target === "father-info") {
                  global.student.FatherName = $('#editModal #name').val();
                  global.student.FatherOtherInfo = {
                    FatherOtherInfo: {
                      Relationship: '父',
                      Phone: $('#editModal #phone').val(),
                      Email: $('#editModal #email').val(),
                      Job: $('#editModal #job').val(),
                      EducationDegree: $('#editModal #education').val()
                    }
                  };
                }
                if (edit_target === "mother-info") {
                  global.student.MotherName = $('#editModal #name').val();
                  global.student.MotherOtherInfo = {
                    MotherOtherInfo: {
                      Relationship: '母',
                      Phone: $('#editModal #phone').val(),
                      Email: $('#editModal #email').val(),
                      Job: $('#editModal #job').val(),
                      EducationDegree: $('#editModal #education').val()
                    }
                  };
                }
                if (request_udt !== "") {
                  gadget.getContract("ischool.addressbook").send({
                    service: global.student.UID === "" ? "addressbook.AddUDTStudentInfo" : "addressbook.UpdateUDTStudentInfo",
                    body: request_udt,
                    result: function(response, error, xhr) {
                      if (error != null) {
                        return $("#editModal #errorMessage").html("<div class='alert alert-error'>\n  <button class='close' data-dismiss='alert'>×</button>\n  <strong>呼叫服務失敗或網路異常，請稍候重試!</strong>\n</div>");
                      } else {
                        if (response.Result.ExecuteCount === "1") {
                          if (edit_target === "message") {
                            global.student.FacebookID = $('#editModal #facebook').val();
                            global.student.SkypeID = $('#editModal #skype').val();
                          }
                          if (edit_target === "emergency-contact") {
                            global.student.EmergencyContactName = $('#editModal #name').val();
                            global.student.EmergencyContactRelationship = $('#editModal #relationship').val();
                            global.student.EmergencyContactTel = $('#editModal #phone').val();
                          }
                        }
                        return $("#editModal").modal("hide");
                      }
                    }
                  });
                } else {
                  $("#editModal").modal("hide");
                }
              }
              return $("#editModal").modal("hide");
            }
          }
        });
      } else {
        if (request_udt !== "") {
          return gadget.getContract("ischool.addressbook").send({
            service: global.student.UID === "" ? "addressbook.AddUDTStudentInfo" : "addressbook.UpdateUDTStudentInfo",
            body: request_udt,
            result: function(response, error, xhr) {
              if (error != null) {
                return $("#editModal #errorMessage").html("<div class='alert alert-error'>\n  <button class='close' data-dismiss='alert'>×</button>\n  <strong>呼叫服務失敗或網路異常，請稍候重試!</strong>\n</div>");
              } else {
                if (response.Result.ExecuteCount === "1") {
                  if (edit_target === "message") {
                    global.student.FacebookID = $('#editModal #facebook').val();
                    global.student.SkypeID = $('#editModal #skype').val();
                  }
                  if (edit_target === "emergency-contact") {
                    global.student.EmergencyContactName = $('#editModal #name').val();
                    global.student.EmergencyContactRelationship = $('#editModal #relationship').val();
                    global.student.EmergencyContactTel = $('#editModal #phone').val();
                  }
                }
                return $("#editModal").modal("hide");
              }
            }
          });
        } else {
          return $("#editModal").modal("hide");
        }
      }
    });
    $("#baseinfo .my-label-title a").click(function() {
      var _ref, _ref1, _ref10, _ref11, _ref12, _ref13, _ref14, _ref15, _ref16, _ref17, _ref18, _ref19, _ref2, _ref20, _ref21, _ref22, _ref23, _ref24, _ref25, _ref26, _ref27, _ref28, _ref29, _ref3, _ref30, _ref31, _ref32, _ref33, _ref34, _ref35, _ref36, _ref37, _ref38, _ref39, _ref4, _ref40, _ref41, _ref42, _ref43, _ref44, _ref45, _ref46, _ref47, _ref48, _ref49, _ref5, _ref50, _ref51, _ref52, _ref53, _ref54, _ref55, _ref56, _ref57, _ref58, _ref59, _ref6, _ref60, _ref61, _ref62, _ref63, _ref64, _ref65, _ref66, _ref67, _ref68, _ref69, _ref7, _ref70, _ref71, _ref72, _ref73, _ref74, _ref75, _ref76, _ref77, _ref78, _ref79, _ref8, _ref80, _ref9;
      if (global.student) {
        if ($(this).attr("edit-target") === "phone") {
          $("#editModal #save-data").attr("edit-target", "phone");
          $("#editModal .modal-header h3").html("編輯 - 電話資訊");
          $("#editModal .modal-body").html("<form class='form-horizontal'>\n  <fieldset>\n    <div class='control-group'>\n      <label class='control-label' for='contact-phone'>通訊</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='contact-phone' value='" + ((_ref = global.student.ContactPhone) != null ? _ref : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='permanent-phone'>戶籍</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='permanent-phone' value='" + ((_ref1 = global.student.PermanentPhone) != null ? _ref1 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='sms-phone'>行動電話</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='sms-phone' value='" + ((_ref2 = global.student.SMSPhone) != null ? _ref2 : "") + "'>\n      </div>\n    </div>\n  </fieldset>\n</form>");
        } else if ($(this).attr("edit-target") === "address") {
          $("#editModal #save-data").attr("edit-target", "address");
          $("#editModal .modal-header h3").html("編輯 - 地址資訊");
          $("#editModal .modal-body").html("<form class='form-horizontal'>\n  <legend>通訊地址</legend>\n  <fieldset>\n    <div class='control-group'>\n      <label class='control-label' for='contact-zip-code'>郵遞區號</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='contact-zip-code' value='" + ((_ref3 = (_ref4 = global.student.MailingAddress) != null ? (_ref5 = _ref4.AddressList) != null ? (_ref6 = _ref5.Address) != null ? _ref6.ZipCode : void 0 : void 0 : void 0) != null ? _ref3 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='contact-county'>縣市</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='contact-county' value='" + ((_ref7 = (_ref8 = global.student.MailingAddress) != null ? (_ref9 = _ref8.AddressList) != null ? (_ref10 = _ref9.Address) != null ? _ref10.County : void 0 : void 0 : void 0) != null ? _ref7 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='contact-town'>鄉鎮市區</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='contact-town' value='" + ((_ref11 = (_ref12 = global.student.MailingAddress) != null ? (_ref13 = _ref12.AddressList) != null ? (_ref14 = _ref13.Address) != null ? _ref14.Town : void 0 : void 0 : void 0) != null ? _ref11 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='contact-detail'>地址</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='contact-detail' value='" + ((_ref15 = (_ref16 = global.student.MailingAddress) != null ? (_ref17 = _ref16.AddressList) != null ? (_ref18 = _ref17.Address) != null ? _ref18.DetailAddress : void 0 : void 0 : void 0) != null ? _ref15 : "") + "'>\n      </div>\n    </div>\n  </fieldset>\n</form>\n<form class='form-horizontal'>\n  <legend>戶籍地址</legend>\n  <fieldset>\n    <div class='control-group'>\n      <label class='control-label' for='permanent-zip-code'>郵遞區號</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='permanent-zip-code' value='" + ((_ref19 = (_ref20 = global.student.PermanentAddress) != null ? (_ref21 = _ref20.AddressList) != null ? (_ref22 = _ref21.Address) != null ? _ref22.ZipCode : void 0 : void 0 : void 0) != null ? _ref19 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='permanent-county'>縣市</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='permanent-county' value='" + ((_ref23 = (_ref24 = global.student.PermanentAddress) != null ? (_ref25 = _ref24.AddressList) != null ? (_ref26 = _ref25.Address) != null ? _ref26.County : void 0 : void 0 : void 0) != null ? _ref23 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='permanent-town'>鄉鎮市區</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='permanent-town' value='" + ((_ref27 = (_ref28 = global.student.PermanentAddress) != null ? (_ref29 = _ref28.AddressList) != null ? (_ref30 = _ref29.Address) != null ? _ref30.Town : void 0 : void 0 : void 0) != null ? _ref27 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='permanent-detail'>地址</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='permanent-detail' value='" + ((_ref31 = (_ref32 = global.student.PermanentAddress) != null ? (_ref33 = _ref32.AddressList) != null ? (_ref34 = _ref33.Address) != null ? _ref34.DetailAddress : void 0 : void 0 : void 0) != null ? _ref31 : "") + "'>\n      </div>\n    </div>\n  </fieldset>\n</form>");
        } else if ($(this).attr("edit-target") === "message") {
          $("#editModal #save-data").attr("edit-target", "message");
          $("#editModal .modal-header h3").html("編輯 - 即時通訊資訊");
          $("#editModal .modal-body").html("<form class='form-horizontal'>\n  <fieldset>\n    <div class='control-group'>\n      <label class='control-label' for='email'>Email</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='email' value='" + ((_ref35 = global.student.EmailAddress) != null ? _ref35 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='facebook'>Facebook</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='facebook' value='" + ((_ref36 = global.student.FacebookID) != null ? _ref36 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='skype'>Skype</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='skype' value='" + ((_ref37 = global.student.SkypeID) != null ? _ref37 : "") + "'>\n      </div>\n    </div>\n  </fieldset>\n</form>");
        } else if ($(this).attr("edit-target") === "emergency-contact") {
          $("#editModal #save-data").attr("edit-target", "emergency-contact");
          $("#editModal .modal-header h3").html("編輯 - 緊急聯絡人資訊");
          $("#editModal .modal-body").html("<form class='form-horizontal'>\n  <fieldset>\n    <div class='control-group'>\n      <label class='control-label' for='name'>姓名</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='name' value='" + ((_ref38 = global.student.EmergencyContactName) != null ? _ref38 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='relationship'>關係</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='relationship' value='" + ((_ref39 = global.student.EmergencyContactRelationship) != null ? _ref39 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='phone'>電話</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='phone' value='" + ((_ref40 = global.student.EmergencyContactTel) != null ? _ref40 : "") + "'>\n      </div>\n    </div>\n  </fieldset>\n</form>");
        } else if ($(this).attr("edit-target") === "custodian-info") {
          $("#editModal #save-data").attr("edit-target", "custodian-info");
          $("#editModal .modal-header h3").html("編輯 - 監護人資訊");
          $("#editModal .modal-body").html("<form class='form-horizontal'>\n  <fieldset>\n    <div class='control-group'>\n      <label class='control-label' for='name'>姓名</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='name' value='" + ((_ref41 = global.student.CustodianName) != null ? _ref41 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='relationship'>關係</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='relationship' value='" + ((_ref42 = global.student.CustodianRelationship) != null ? _ref42 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='phone'>電話</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='phone' value='" + ((_ref43 = (_ref44 = global.student.CustodianOtherInfo) != null ? (_ref45 = _ref44.CustodianOtherInfo) != null ? _ref45.Phone : void 0 : void 0) != null ? _ref43 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='email'>Email</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='email' value='" + ((_ref46 = (_ref47 = global.student.CustodianOtherInfo) != null ? (_ref48 = _ref47.CustodianOtherInfo) != null ? _ref48.Email : void 0 : void 0) != null ? _ref46 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='job'>職業</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='job' value='" + ((_ref49 = (_ref50 = global.student.CustodianOtherInfo) != null ? (_ref51 = _ref50.CustodianOtherInfo) != null ? _ref51.Job : void 0 : void 0) != null ? _ref49 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='education'>教育程度</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='education' value='" + ((_ref52 = (_ref53 = global.student.CustodianOtherInfo) != null ? (_ref54 = _ref53.CustodianOtherInfo) != null ? _ref54.EducationDegree : void 0 : void 0) != null ? _ref52 : "") + "'>\n      </div>\n    </div>\n  </fieldset>\n</form>");
        } else if ($(this).attr("edit-target") === "father-info") {
          $("#editModal #save-data").attr("edit-target", "father-info");
          $("#editModal .modal-header h3").html("編輯 - 父親資訊");
          $("#editModal .modal-body").html("<form class='form-horizontal'>\n  <fieldset>\n    <div class='control-group'>\n      <label class='control-label' for='name'>姓名</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='name' value='" + ((_ref55 = global.student.FatherName) != null ? _ref55 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='phone'>電話</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='phone' value='" + ((_ref56 = (_ref57 = global.student.FatherOtherInfo) != null ? (_ref58 = _ref57.FatherOtherInfo) != null ? _ref58.Phone : void 0 : void 0) != null ? _ref56 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='email'>Email</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='email' value='" + ((_ref59 = (_ref60 = global.student.FatherOtherInfo) != null ? (_ref61 = _ref60.FatherOtherInfo) != null ? _ref61.Email : void 0 : void 0) != null ? _ref59 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='job'>職業</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='job' value='" + ((_ref62 = (_ref63 = global.student.FatherOtherInfo) != null ? (_ref64 = _ref63.FatherOtherInfo) != null ? _ref64.Job : void 0 : void 0) != null ? _ref62 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='education'>教育程度</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='education' value='" + ((_ref65 = (_ref66 = global.student.FatherOtherInfo) != null ? (_ref67 = _ref66.FatherOtherInfo) != null ? _ref67.EducationDegree : void 0 : void 0) != null ? _ref65 : "") + "'>\n      </div>\n    </div>\n  </fieldset>\n</form>");
        } else if ($(this).attr("edit-target") === "mother-info") {
          $("#editModal #save-data").attr("edit-target", "mother-info");
          $("#editModal .modal-header h3").html("編輯 - 母親資訊");
          $("#editModal .modal-body").html("<form class='form-horizontal'>\n  <fieldset>\n    <div class='control-group'>\n      <label class='control-label' for='name'>姓名</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='name' value='" + ((_ref68 = global.student.MotherName) != null ? _ref68 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='phone'>電話</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='phone' value='" + ((_ref69 = (_ref70 = global.student.MotherOtherInfo) != null ? (_ref71 = _ref70.MotherOtherInfo) != null ? _ref71.Phone : void 0 : void 0) != null ? _ref69 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='email'>Email</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='email' value='" + ((_ref72 = (_ref73 = global.student.MotherOtherInfo) != null ? (_ref74 = _ref73.MotherOtherInfo) != null ? _ref74.Email : void 0 : void 0) != null ? _ref72 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='job'>職業</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='job' value='" + ((_ref75 = (_ref76 = global.student.MotherOtherInfo) != null ? (_ref77 = _ref76.MotherOtherInfo) != null ? _ref77.Job : void 0 : void 0) != null ? _ref75 : "") + "'>\n      </div>\n    </div>\n    <div class='control-group'>\n      <label class='control-label' for='education'>教育程度</label>\n      <div class='controls'>\n        <input type='text' class='input-large' id='education' value='" + ((_ref78 = (_ref79 = global.student.MotherOtherInfo) != null ? (_ref80 = _ref79.MotherOtherInfo) != null ? _ref80.EducationDegree : void 0 : void 0) != null ? _ref78 : "") + "'>\n      </div>\n    </div>\n  </fieldset>\n</form>");
        }
        return $("#editModal").modal("show");
      }
    });
    $("#student-list").hover(function() {
      return $(this).css("overflow", "auto");
    }, function() {
      return $(this).css("overflow", "hidden");
    });
    $("#baseinfo").hover(function() {
      return $(this).css("overflow", "auto");
    }, function() {
      return $(this).css("overflow", "hidden");
    });
    $("#academic").hover(function() {
      return $(this).css("overflow", "auto");
    }, function() {
      return $(this).css("overflow", "hidden");
    });
    $("#behavior").hover(function() {
      return $(this).css("overflow", "auto");
    }, function() {
      return $(this).css("overflow", "hidden");
    });
    gadget.getContract("ta").send({
      service: "TeacherAccess.GetCurrentSemester",
      body: "",
      result: function(response, error, xhr) {
        var items;
        global.schoolYear = response.Current.SchoolYear;
        global.semester = response.Current.Semester;
        global.academic = {
          schoolYear: response.Current.SchoolYear,
          semester: response.Current.Semester
        };
        global.behavior = {
          schoolYear: response.Current.SchoolYear,
          semester: response.Current.Semester
        };
        items = "				\n" + (global.semester === '2' ? "<button class='btn btn-large active' school-year='" + global.schoolYear + "' semester='2'>" + global.schoolYear + "2</button>" : "") + "\n<button class='btn btn-large " + (global.semester === '2' ? '' : 'active') + " school-year='" + global.schoolYear + "' semester='1'>" + global.schoolYear + "1</button>\n<button class='btn btn-large' school-year='" + (global.schoolYear - 1) + "' semester='2'>" + (global.schoolYear - 1) + "2</button>\n<button class='btn btn-large' school-year='" + (global.schoolYear - 1) + "' semester='1'>" + (global.schoolYear - 1) + "1</button>\n<button class='btn btn-large' school-year='" + (global.schoolYear - 2) + "' semester='2'>" + (global.schoolYear - 2) + "2</button>\n<button class='btn btn-large' school-year='" + (global.schoolYear - 2) + "' semester='1'>" + (global.schoolYear - 2) + "1</button>";
        $("#academic .btn-group").html(items);
        $("#academic .btn-group button").click(function(e) {
          e.preventDefault();
          if (global.student != null) {
            global.academic = {
              schoolYear: $(this).attr("school-year"),
              semester: $(this).attr("semester")
            };
            $("#academic #subject-score tbody").html("");
            $("#academic #domain-score tbody").html("");
            return getAcademic();
          }
        });
        $("#behavior .btn-group").html(items);
        return $("#behavior .btn-group button").click(function(e) {
          e.preventDefault();
          if (global.student != null) {
            global.behavior = {
              schoolYear: $(this).attr("school-year"),
              semester: $(this).attr("semester")
            };
            $("#behavior #morality tbody").html("");
            $("#behavior #attendance .my-content").html("");
            $("#behavior #discipline tbody").html("");
            getMorality();
            getAttendance();
            return getDiscipline();
          }
        });
      }
    });
    return gadget.getContract("ischool.addressbook").send({
      service: "addressbook.GetStudentInfo",
      body: "",
      result: function(response, error, xhr) {
        var accordionHTML, className, items, _ref;
        if (((_ref = response.Result) != null ? _ref.Student : void 0) != null) {
          resetData();
          global.students = $(response.Result.Student);
          className = "";
          items = [];
          accordionHTML = "";
          global.students.each(function(index, student) {
            if (this.ClassName !== className) {
              className = this.ClassName;
              if (accordionHTML != null) {
                accordionHTML += items.join("");
                accordionHTML += "      </ul>\n    </div>\n  </div>\n</div>";
                items.splice(0);
              }
              accordionHTML += "<div class='accordion-group'>\n  <div class='accordion-heading my-nav-header'>\n    <a class='accordion-toggle' data-toggle='collapse' data-parent='#student-list' href='#collapse" + index + "'><i class=\"icon-user\"></i>" + this.ClassName + "</a>\n  </div>\n  <div id='collapse" + index + "' class='accordion-body collapse " + (index === 0 ? 'in' : '') + "'>\n    <div class='accordion-inner'>\n      <ul class='nav nav-tabs nav-stacked'>";
            }
            items.push("<li " + (index === 0 ? " class='active'" : '') + ">\n  <a href='#' student-index='" + index + "'>\n    <span class='my-seat-no label label-inverse my-label'>" + this.SeatNo + "</span>\n    <span class='my-student-name'>" + this.StudentName + "</span>								\n    <span class='my-student-number'>" + this.StudentNumber + "</span>\n    <i class='icon-chevron-right pull-right " + (index === 0 ? "" : " icon-white") + "'></i>\n  </a>\n</li>");
            if (index === 0) {
              global.student = student;
              setBaseInfo();
              getAcademic();
              getMorality();
              getAttendance();
              return getDiscipline();
            }
          });
          accordionHTML += items.join("");
          accordionHTML += "      </ul>\n    </div>\n  </div>\n</div>";
          $("#student-list").html(accordionHTML);
          return $("#student-list .accordion-body a").click(function(e) {
            e.preventDefault();
            $(this).tab("show");
            $("#student-list .accordion-body a i").addClass("icon-white");
            $(this).find("i").removeClass("icon-white");
            global.student = global.students[$(this).attr("student-index")];
            resetData();
            setBaseInfo();
            getAcademic();
            getMorality();
            getAttendance();
            return getDiscipline();
          });
        }
      }
    });
  });

  resetData = function() {
    $("#baseinfo #base-content").html("");
    $("#baseinfo #phone tbody").html("");
    $("#baseinfo #address tbody").html("");
    $("#baseinfo #message tbody").html("");
    $("#baseinfo #emergency-contact tbody").html("");
    $("#baseinfo #custodian-info tbody").html("");
    $("#baseinfo #father-info tbody").html("");
    $("#baseinfo #mother-info tbody").html("");
    $("#academic #subject-score tbody").html("");
    $("#academic #domain-score tbody").html("");
    $("#behavior #morality tbody").html("");
    $("#behavior #attendance .my-content").html("");
    return $("#behavior #discipline tbody").html("");
  };

  setBaseInfo = function() {
    var freshmanPhoto, graduatePhoto, mailingAddress, permanentAddress, student, _ref, _ref1, _ref10, _ref11, _ref12, _ref13, _ref14, _ref15, _ref16, _ref17, _ref18, _ref19, _ref2, _ref20, _ref21, _ref22, _ref23, _ref24, _ref25, _ref26, _ref27, _ref28, _ref29, _ref3, _ref30, _ref31, _ref32, _ref33, _ref34, _ref35, _ref36, _ref37, _ref38, _ref39, _ref4, _ref40, _ref41, _ref42, _ref43, _ref44, _ref45, _ref46, _ref47, _ref48, _ref49, _ref5, _ref50, _ref51, _ref52, _ref53, _ref54, _ref55, _ref56, _ref57, _ref58, _ref59, _ref6, _ref60, _ref61, _ref62, _ref63, _ref64, _ref65, _ref66, _ref67, _ref68, _ref69, _ref7, _ref70, _ref71, _ref72, _ref8, _ref9;
    student = global.student;
    freshmanPhoto = (student.FreshmanPhoto != null) && student.FreshmanPhoto !== "" ? "<img src='data:image/png;base64," + student.FreshmanPhoto + "' class='my-photo'/>" : "";
    graduatePhoto = (student.GraduatePhoto != null) && student.GraduatePhoto !== "" ? "<img src='data:image/png;base64," + student.GraduatePhoto + "' class='my-photo'/>" : "";
    console.log(student);
    if (freshmanPhoto === "") {
      if (student.Gender === "1") {
        freshmanPhoto = "<img src='img/photo_male.png' class='my-photo' alt='入學照' title='入學照' />";
      } else {
        freshmanPhoto = "<img src='img/photo_female.png' class='my-photo' alt='畢業照' title='畢業照'/>";
      }
    }
    if (graduatePhoto === "") {
      if (student.Gender === "1") {
        graduatePhoto = "<img src='img/photo_male.png' class='my-photo'/>";
      } else {
        graduatePhoto = "<img src='img/photo_female.png' class='my-photo'/>";
      }
    }
    mailingAddress = ((_ref = student.MailingAddress) != null ? (_ref1 = _ref.AddressList) != null ? (_ref2 = _ref1.Address) != null ? _ref2.ZipCode : void 0 : void 0 : void 0) + ((_ref3 = student.MailingAddress) != null ? (_ref4 = _ref3.AddressList) != null ? (_ref5 = _ref4.Address) != null ? _ref5.County : void 0 : void 0 : void 0) + ((_ref6 = student.MailingAddress) != null ? (_ref7 = _ref6.AddressList) != null ? (_ref8 = _ref7.Address) != null ? _ref8.Town : void 0 : void 0 : void 0) + ((_ref9 = student.MailingAddress) != null ? (_ref10 = _ref9.AddressList) != null ? (_ref11 = _ref10.Address) != null ? _ref11.DetailAddress : void 0 : void 0 : void 0);
    permanentAddress = ((_ref12 = student.PermanentAddress) != null ? (_ref13 = _ref12.AddressList) != null ? (_ref14 = _ref13.Address) != null ? _ref14.ZipCode : void 0 : void 0 : void 0) + ((_ref15 = student.PermanentAddress) != null ? (_ref16 = _ref15.AddressList) != null ? (_ref17 = _ref16.Address) != null ? _ref17.County : void 0 : void 0 : void 0) + ((_ref18 = student.PermanentAddress) != null ? (_ref19 = _ref18.AddressList) != null ? (_ref20 = _ref19.Address) != null ? _ref20.Town : void 0 : void 0 : void 0) + ((_ref21 = student.PermanentAddress) != null ? (_ref22 = _ref21.AddressList) != null ? (_ref23 = _ref22.Address) != null ? _ref23.DetailAddress : void 0 : void 0 : void 0);
    $("#baseinfo #base-content").html("<div class='span6'>\n  <div class='page-header'>\n    <h1>" + ((_ref24 = student.StudentName) != null ? _ref24 : "") + " <small>" + ((_ref25 = student.EnglishName) != null ? _ref25 : "") + "</small></h1>\n  </div>\n  <p>" + (student.Birthdate ? student.Birthdate.substr(0, 10) : "") + "</p>\n  <p>" + ((_ref26 = student.IDNumber) != null ? _ref26 : "") + "</p>\n</div>\n<div class='span6'>\n  " + freshmanPhoto + graduatePhoto + "\n</div>");
    $("#baseinfo #phone tbody").html("<tr><th><span>通訊</span></th><td><span>" + ((_ref27 = student.ContactPhone) != null ? _ref27 : "") + "</span></td></tr>\n<tr><th><span>戶籍</span></th><td><span>" + ((_ref28 = student.PermanentPhone) != null ? _ref28 : "") + "</span></td></tr>\n<tr><th><span>行動</span></th><td><span>" + ((_ref29 = student.SMSPhone) != null ? _ref29 : "") + "</span></td></tr>");
    $("#baseinfo #address tbody").html("<tr><th><span>通訊</span></th><td><span>" + mailingAddress + "</span></div>\n<tr><th><span>戶籍</span></th><td><span>" + permanentAddress + "</span></div>");
    $("#baseinfo #message tbody").html("<tr><th><span>Email</span></th><td><span>" + student.EmailAddress + "</span></td></tr>\n<tr><th><span>Facebook</span></th><td><span>" + student.FacebookID + "</span></td></tr>\n<tr><th><span>Skype</span></th><td><span>" + student.SkypeID + "</span></td></tr>");
    $("#baseinfo #emergency-contact tbody").html("<tr><th><span>姓名</span></th><td><span>" + ((_ref30 = student.EmergencyContactName) != null ? _ref30 : "") + "</span></td></tr>\n<tr><th><span>關係</span></th><td><span>" + ((_ref31 = student.EmergencyContactRelationship) != null ? _ref31 : "") + "</span></td></tr>\n<tr><th><span>電話</span></th><td><span>" + ((_ref32 = student.EmergencyContactTel) != null ? _ref32 : "") + "</span></td></tr>");
    $("#baseinfo #custodian-info tbody").html("<tr><th><span>姓名</span></th><td><span>" + ((_ref33 = student.CustodianName) != null ? _ref33 : "") + "</span></td></tr>\n<tr><th><span>關係</span></th><td><span>" + ((_ref34 = student.CustodianRelationship) != null ? _ref34 : "") + "</span></td></tr>\n<tr><th><span>電話</span></th><td><span>" + ((_ref35 = (_ref36 = student.CustodianOtherInfo) != null ? (_ref37 = _ref36.CustodianOtherInfo) != null ? _ref37.Phone : void 0 : void 0) != null ? _ref35 : "") + "</span></td></tr>\n<tr><th><span>Email</span></th><td><span>" + ((_ref38 = (_ref39 = student.CustodianOtherInfo) != null ? (_ref40 = _ref39.CustodianOtherInfo) != null ? _ref40.Email : void 0 : void 0) != null ? _ref38 : "") + "</span></td></tr>\n<tr><th><span>職業</span></th><td><span>" + ((_ref41 = (_ref42 = student.CustodianOtherInfo) != null ? (_ref43 = _ref42.CustodianOtherInfo) != null ? _ref43.Job : void 0 : void 0) != null ? _ref41 : "") + "</span></td></tr>\n<tr><th><span>教育程度</span></th><td><span>" + ((_ref44 = (_ref45 = student.CustodianOtherInfo) != null ? (_ref46 = _ref45.CustodianOtherInfo) != null ? _ref46.EducationDegree : void 0 : void 0) != null ? _ref44 : "") + "</span></td></tr>");
    $("#baseinfo #father-info tbody").html("<tr><th><span>姓名</span></th><td><span>" + ((_ref47 = student.FatherName) != null ? _ref47 : "") + "</span></td></tr>\n<tr><th><span>電話</span></th><td><span>" + ((_ref48 = (_ref49 = student.FatherOtherInfo) != null ? (_ref50 = _ref49.FatherOtherInfo) != null ? _ref50.FatherPhone : void 0 : void 0) != null ? _ref48 : "") + "</span></td></tr>\n<tr><th><span>Email</span></th><td><span>" + ((_ref51 = (_ref52 = student.FatherOtherInfo) != null ? (_ref53 = _ref52.FatherOtherInfo) != null ? _ref53.FatherEmail : void 0 : void 0) != null ? _ref51 : "") + "</span></td></tr>\n<tr><th><span>職業</span></th><td><span>" + ((_ref54 = (_ref55 = student.FatherOtherInfo) != null ? (_ref56 = _ref55.FatherOtherInfo) != null ? _ref56.FatherJob : void 0 : void 0) != null ? _ref54 : "") + "</span></td></tr>\n<tr><th><span>教育程度</span></th><td><span>" + ((_ref57 = (_ref58 = student.FatherOtherInfo) != null ? (_ref59 = _ref58.FatherOtherInfo) != null ? _ref59.FatherEducationDegree : void 0 : void 0) != null ? _ref57 : "") + "</span></td></tr>");
    return $("#baseinfo #mother-info tbody").html("<tr><th><span>姓名</span></th><td><span>" + ((_ref60 = student.MotherName) != null ? _ref60 : "") + "</span></td></tr>\n<tr><th><span>電話</span></th><td><span>" + ((_ref61 = (_ref62 = student.MotherOtherInfo) != null ? (_ref63 = _ref62.MotherOtherInfo) != null ? _ref63.MotherPhone : void 0 : void 0) != null ? _ref61 : "") + "</span></td></tr>\n<tr><th><span>Email</span></th><td><span>" + ((_ref64 = (_ref65 = student.MotherOtherInfo) != null ? (_ref66 = _ref65.MotherOtherInfo) != null ? _ref66.MotherEmail : void 0 : void 0) != null ? _ref64 : "") + "</span></td></tr>\n<tr><th><span>職業</span></th><td><span>" + ((_ref67 = (_ref68 = student.MotherOtherInfo) != null ? (_ref69 = _ref68.MotherOtherInfo) != null ? _ref69.MotherJob : void 0 : void 0) != null ? _ref67 : "") + "</span></td></tr>\n<tr><th><span>教育程度</span></th><td><span>" + ((_ref70 = (_ref71 = student.MotherOtherInfo) != null ? (_ref72 = _ref71.MotherOtherInfo) != null ? _ref72.MotherEducationDegree : void 0 : void 0) != null ? _ref70 : "") + "</span></td></tr>");
  };

  getAcademic = function() {
    return gadget.getContract("ischool.addressbook").send({
      service: "addressbook.GetSubjectSemesterScore",
      body: "<Request>\n  <StudentID>" + global.student.StudentID + "</StudentID>\n  <SchoolYear>" + global.academic.schoolYear + "</SchoolYear>\n  <Semester>" + global.academic.semester + "</Semester>\n</Request>",
      result: function(response, error, xhr) {
        var items, _ref, _ref1, _ref10, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9;
        if (((_ref = response.Result.SemsSubjScore) != null ? (_ref1 = _ref.ScoreInfo) != null ? _ref1.Domains : void 0 : void 0) != null) {
          items = [];
          if (((_ref2 = response.Result.SemsSubjScore) != null ? (_ref3 = _ref2.ScoreInfo) != null ? (_ref4 = _ref3.SemesterSubjectScoreInfo) != null ? _ref4.Subject : void 0 : void 0 : void 0) != null) {
            $(response.Result.SemsSubjScore.ScoreInfo.SemesterSubjectScoreInfo.Subject).each(function() {
              var _ref5, _ref6;
              return items.push("<tr>\n  <th>\n    <span>" + this.科目 + "</span>\n  </th>\n  <td>\n    <span>" + this.成績 + " / " + ((_ref5 = (_ref6 = this.努力程度) != null ? _ref6 : this.文字描述) != null ? _ref5 : '') + "</span>\n  </td>\n</tr>");
            });
            $("#academic #subject-score tbody").html(items.join(""));
            $("#academic #subject-score h2").html("科目成績");
          }
          items = [];
          if (((_ref5 = response.Result.SemsSubjScore) != null ? (_ref6 = _ref5.ScoreInfo) != null ? (_ref7 = _ref6.Domains) != null ? _ref7.Domain : void 0 : void 0 : void 0) != null) {
            $(response.Result.SemsSubjScore.ScoreInfo.Domains.Domain).each(function() {
              var _ref8, _ref9;
              return items.push("<tr>\n  <th>\n    <span>" + this.領域 + "</span>\n  </th>\n  <td>\n    <span>" + this.成績 + " / " + ((_ref8 = (_ref9 = this.努力程度) != null ? _ref9 : this.文字描述) != null ? _ref8 : '') + "</span>\n  </td>\n</tr>");
            });
            $("#academic #domain-score tbody").html(item.join(""));
            return $("#academic #domain-score h2").html("領域成績");
          }
        } else {
          items = [];
          if (((_ref8 = response.Result.SemsSubjScore) != null ? (_ref9 = _ref8.ScoreInfo) != null ? (_ref10 = _ref9.SemesterSubjectScoreInfo) != null ? _ref10.Subject : void 0 : void 0 : void 0) != null) {
            $(response.Result.SemsSubjScore.ScoreInfo.SemesterSubjectScoreInfo.Subject).each(function() {
              var score;
              score = Math.max(this.原始成績, this.補考成績, this.重修成績, this.擇優採計成績, this.學年調整成績);
              if (score === parseInt(this.補考成績, 10)) {
                score = score + "(補)";
              }
              if (score === parseInt(this.重修成績, 10)) {
                score = score + "(重)";
              }
              if (score === parseInt(this.擇優採計成績, 10)) {
                score = score + "(手)";
              }
              if (score === parseInt(this.學年調整成績, 10)) {
                score = score + "(調)";
              }
              return items.push("<tr>\n  <th>\n    <span>" + this.科目 + "</span>\n  </th>\n  <td>\n    <span>" + score + "</span>\n  </td>\n</tr>");
            });
            $("#academic #subject-score tbody").html(items.join(""));
            $("#academic #subject-score h2").html("科目成績");
          }
          return gadget.getContract("ischool.addressbook").send({
            service: "addressbook.GetEntryScore",
            body: "<Request>\n  <StudentID>" + global.student.StudentID + "</StudentID>\n  <SchoolYear>" + global.academic.schoolYear + "</SchoolYear>\n  <Semester>" + global.academic.semester + "</Semester>\n</Request>",
            result: function(response, status, xhr) {
              $("#domain-score h2").html("分項成績");
              items = [];
              if (response.Result.SemsEntryScore != null) {
                return $(response.Result.SemsEntryScore).each(function() {
                  var _ref11, _ref12;
                  if (((_ref11 = this.ScoreInfo) != null ? (_ref12 = _ref11.SemesterEntryScore) != null ? _ref12.Entry : void 0 : void 0) != null) {
                    $(this.ScoreInfo.SemesterEntryScore.Entry).each(function() {
                      return items.push("<tr>\n  <th>\n    <span>" + this.分項 + "</span>\n  </th>\n  <td>\n    <span>" + this.成績 + "</span>\n  </td>\n</tr>");
                    });
                    return $("#academic #domain-score tbody").html(items.join(""));
                  }
                });
              }
            }
          });
        }
      }
    });
  };

  getMorality = function() {
    return gadget.getContract("ischool.addressbook").send({
      service: "addressbook.GetMoralScore",
      body: "<Request>\n  <StudentID>" + global.student.StudentID + "</StudentID>\n  <SchoolYear>" + global.behavior.schoolYear + "</SchoolYear>\n  <Semester>" + global.behavior.semester + "</Semester>\n</Request>",
      result: function(response, error, xhr) {
        var items, _ref, _ref1, _ref2, _ref3;
        items = [];
        if (((_ref = response.Result) != null ? (_ref1 = _ref.DailyLifeScore) != null ? (_ref2 = _ref1.Content) != null ? _ref2.Morality : void 0 : void 0 : void 0) != null) {
          $(response.Result.DailyLifeScore.Content.Morality).each(function() {
            return items.push("<tr>\n  <th><span>" + this['@text'] + "</span></th>\n  <td><span>" + this.Face + "</span></td>\n</tr>");
          });
          $("#behavior #morality tbody").html(items.join(""));
          return $("#behavior #morality h2").html("德行成績");
        } else if (((_ref3 = response.Result.DailyLifeScore) != null ? _ref3.TextScore : void 0) != null) {
          $(response.Result.DailyLifeScore.TextScore).each(function() {
            var _ref10, _ref11, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9;
            if (this.DailyBehavior != null) {
              items.push("<tr><th colspan='2'><span>" + ((_ref4 = this.DailyBehavior.Name) != null ? _ref4 : '日常行為表現') + "</span></th></tr>");
              $(this.DailyBehavior.Item).each(function() {
                var _ref5;
                return items.push("<tr>\n  <th><span>" + ((_ref5 = this.Degree) != null ? _ref5 : '') + "</span></th>\n  <td><span>" + this.Name + " " + this.Index + "</span></td>\n</tr>");
              });
            }
            if (this.GroupActivity != null) {
              items.push("<tr><th colspan='2'><span>" + ((_ref5 = this.GroupActivity.Name) != null ? _ref5 : '團體活動表現') + "</span></th></tr>");
              $(this.GroupActivity.Item).each(function() {
                var _ref6;
                return items.push("<tr>\n  <th><span>" + ((_ref6 = this.Degree) != null ? _ref6 : '') + "</span></th>\n  <td><span>" + this.Name + "</span></td>\n</tr>");
              });
            }
            if (this.PublicService != null) {
              items.push("<tr><th colspan='2'><span>" + ((_ref6 = this.PublicService.Name) != null ? _ref6 : '公共服務表現') + "</span></th></tr>");
              $(this.PublicService.Item).each(function() {
                var _ref7;
                return items.push("<tr>\n  <th><span>" + ((_ref7 = this.Description) != null ? _ref7 : '') + "</span></th>\n  <td><span>" + this.Name + "</span></td>\n</tr>");
              });
            }
            if (this.SchoolSpecial != null) {
              items.push("<tr><th colspan='2'><span>" + ((_ref7 = this.SchoolSpecial.Name) != null ? _ref7 : '校內外特殊表現') + "</span></th></tr>");
              $(this.SchoolSpecial.Item).each(function() {
                var _ref8;
                return items.push("<tr>\n  <th><span>" + ((_ref8 = this.Description) != null ? _ref8 : '') + "</span></th>\n  <td><span>" + this.Name + "</span></td>\n</tr>");
              });
            }
            if (this.DailyLifeRecommend != null) {
              items.push("<tr><th colspan='2'><span>" + ((_ref8 = this.DailyLifeRecommend.Name) != null ? _ref8 : '日常生活表現具體建議') + "</span></th></tr>");
              items.push("<tr><td colspan='2'><span>" + ((_ref9 = this.DailyLifeRecommend.Description) != null ? _ref9 : this.DailyLifeRecommend['#text']) + "</span></td></tr>");
            }
            if (this.OtherRecommend != null) {
              items.push("<tr><th colspan='2'><span>" + ((_ref10 = this.OtherRecommend.Name) != null ? _ref10 : '其他具體建議') + "</span></th></tr>");
              return items.push("<tr><td colspan='2'><span>" + ((_ref11 = this.OtherRecommend['#text']) != null ? _ref11 : '') + "</span></td></tr>");
            }
          });
          $("#behavior #morality tbody").html(items.join(""));
          return $("#behavior #morality h2").html("日常生活表現");
        }
      }
    });
  };

  getAttendance = function() {
    return gadget.getContract("ischool.addressbook").send({
      service: "addressbook.GetAttendanceRecord",
      body: "<Request>\n  <StudentID>" + global.student.StudentID + "</StudentID>\n  <SchoolYear>" + global.behavior.schoolYear + "</SchoolYear>\n  <Semester>" + global.behavior.semester + "</Semester>\n</Request>",
      result: function(response, error, xhr) {
        var absences, items, name, _ref;
        absences = {};
        if (((_ref = response.Result) != null ? _ref.Attendance : void 0) != null) {
          $(response.Result.Attendance).each(function() {
            return $(this.Detail.Attendance.Period).each(function() {
              if (!(absences[this['AbsenceType']] != null)) {
                absences[this['AbsenceType']] = 0;
              }
              return absences[this['AbsenceType']] += 1;
            });
          });
        }
        items = [];
        for (name in absences) {
          items.push("<li class='span2'>\n  <div class='thumbnail my-thumbnail-white'>\n    <div class='my-subthumbnail-top'>\n      <span class='badge badge-warning'>" + absences[name] + "</span>\n    </div>\n    <div class='caption my-subthumbnail-bottom'>\n      <h5>" + name + "</h5>\n    </div>\n  </div>\n</li>");
        }
        return $("#behavior #attendance .my-content").html("<ul class='thumbnails'>\n  " + (items.join("")) + "\n</ul>");
      }
    });
  };

  getDiscipline = function() {
    return gadget.getContract("ischool.addressbook").send({
      service: "addressbook.GetDisciplineRecord",
      body: "<Request>\n  <StudentID>" + global.student.StudentID + "</StudentID>\n</Request>",
      result: function(response, error, xhr) {
        var items, sum_merit, _ref;
        items = [];
        if (((_ref = response.Result) != null ? _ref.Discipline : void 0) != null) {
          sum_merit = {
            ma: 0,
            mb: 0,
            mc: 0,
            da: 0,
            db: 0,
            dc: 0
          };
          $(response.Result.Discipline).each(function() {
            var merit;
            merit = {
              a: 0,
              b: 0,
              c: 0
            };
            if (this.MeritFlag === "1") {
              if (!isNaN(parseInt(this.Detail.Discipline.Merit.A, 10))) {
                sum_merit.ma += merit.a = parseInt(this.Detail.Discipline.Merit.A, 10);
              }
              if (!isNaN(parseInt(this.Detail.Discipline.Merit.B, 10))) {
                sum_merit.mb += merit.b = parseInt(this.Detail.Discipline.Merit.B, 10);
              }
              if (!isNaN(parseInt(this.Detail.Discipline.Merit.C, 10))) {
                sum_merit.mc += merit.c = parseInt(this.Detail.Discipline.Merit.C, 10);
              }
              return items.push("<tr>\n  <td>\n    <span class=\"badge " + (merit.a !== 0 ? "badge-success" : "") + "\">" + merit.a + "</span>\n    <br />大功\n  </td>\n  <td>\n    <span class=\"badge " + (merit.b !== 0 ? "badge-success" : "") + "\">" + merit.b + "</span>\n    <br />小功\n  </td>\n  <td>\n    <span class=\"badge " + (merit.c !== 0 ? "badge-success" : "") + "\">" + merit.c + "</span>\n    <br />嘉獎\n  </td>\n  <td>\n    <span>" + (this.OccurDate.substr(0, 10)) + "</span>\n    <br/>\n    <span>" + this.Reason + "</span>\n  </td>\n</tr>");
            } else {
              if (!isNaN(parseInt(this.Detail.Discipline.Demerit.A, 10))) {
                sum_merit.da += merit.a = parseInt(this.Detail.Discipline.Demerit.A, 10);
              }
              if (!isNaN(parseInt(this.Detail.Discipline.Demerit.B, 10))) {
                sum_merit.db += merit.b = parseInt(this.Detail.Discipline.Demerit.B, 10);
              }
              if (!isNaN(parseInt(this.Detail.Discipline.Demerit.C, 10))) {
                sum_merit.dc += merit.c = parseInt(this.Detail.Discipline.Demerit.C, 10);
              }
              return items.push("<tr>\n  <td>\n    <span class=\"badge " + (merit.a !== 0 ? "badge-important" : "") + "\">" + merit.a + "</span>\n    <br />大過\n  </td>\n  <td>\n    <span class=\"badge " + (merit.b !== 0 ? "badge-important" : "") + "\">" + merit.b + "</span>\n    <br />小過\n  </td>\n  <td>\n    <span class=\"badge " + (merit.c !== 0 ? "badge-important" : "") + "\">" + merit.c + "</span>\n    <br />警告\n  </td>\n  <td>\n    <span>" + (this.OccurDate.substr(0, 10)) + "</span>\n    <br/>\n    <span>" + this.Reason + "</span>\n    <br/>\n    " + (this.Detail.Discipline.Demerit.Cleared === '是' ? "<span>" + (this.Detail.Discipline.Demerit.ClearDate.substr(0, 10).replace(/\//ig, "-")) + " 已銷過<br/>" + this.Detail.Discipline.Demerit.ClearReason + "</span>" : "") + "\n  </td>\n</tr>");
            }
          });
          $("#merit-a").html("<span class='badge " + (sum_merit.ma !== 0 ? "badge-success" : "") + "'>" + sum_merit.ma + "</span>");
          $("#merit-b").html("<span class='badge " + (sum_merit.mb !== 0 ? "badge-success" : "") + "'>" + sum_merit.mb + "</span>");
          $("#merit-c").html("<span class='badge " + (sum_merit.mc !== 0 ? "badge-success" : "") + "'>" + sum_merit.mc + "</span>");
          $("#demerit-a").html("<span class='badge " + (sum_merit.da !== 0 ? "badge-important" : "") + "'>" + sum_merit.da + "</span>");
          $("#demerit-b").html("<span class='badge " + (sum_merit.db !== 0 ? "badge-important" : "") + "'>" + sum_merit.db + "</span>");
          $("#demerit-c").html("<span class='badge " + (sum_merit.dc !== 0 ? "badge-important" : "") + "'>" + sum_merit.dc + "</span>");
          return $("#behavior #discipline tbody").html(items.join(""));
        }
      }
    });
  };

}).call(this);
