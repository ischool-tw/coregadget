// Generated by CoffeeScript 1.3.3
(function() {
  var bind_address, bind_baseinfo, bind_data_source, bind_education, bind_experience, bind_myinfo, educations, experiences, myInfo;

  $(function() {
    $("td[target='data-sharing']").click(function(e) {
      e.preventDefault();
      return $(this).find("span").toggleClass("hide").closest('div').toggleClass('square');
    });
    $('.modal').on('shown', function() {
      $('.modal-body', $(this)).scrollTop(0);
      return $('.error').removeClass('error');
    });
    $(".modal[target='address'] a[target='accept']").click(function(e) {
      e.preventDefault();
      if ($(this).attr("edit-type") === "MailingAddress") {
        myInfo.MailingAddress.AddressList.Address.ZipCode = $(".modal[target='address'] input[target='zipcode']").val();
        myInfo.MailingAddress.AddressList.Address.County = $(".modal[target='address'] input[target='county']").val();
        myInfo.MailingAddress.AddressList.Address.Town = $(".modal[target='address'] input[target='town']").val();
        myInfo.MailingAddress.AddressList.Address.District = $(".modal[target='address'] input[target='district']").val();
        myInfo.MailingAddress.AddressList.Address.Area = $(".modal[target='address'] input[target='area']").val();
        myInfo.MailingAddress.AddressList.Address.DetailAddress = $(".modal[target='address'] input[target='detail']").val();
      }
      if ($(this).attr("edit-type") === "OtherAddresses") {
        myInfo.OtherAddresses.AddressList.Address.ZipCode = $(".modal[target='address'] input[target='zipcode']").val();
        myInfo.OtherAddresses.AddressList.Address.County = $(".modal[target='address'] input[target='county']").val();
        myInfo.OtherAddresses.AddressList.Address.Town = $(".modal[target='address'] input[target='town']").val();
        myInfo.OtherAddresses.AddressList.Address.District = $(".modal[target='address'] input[target='district']").val();
        myInfo.OtherAddresses.AddressList.Address.Area = $(".modal[target='address'] input[target='area']").val();
        myInfo.OtherAddresses.AddressList.Address.DetailAddress = $(".modal[target='address'] input[target='detail']").val();
      }
      bind_address();
      return $(".modal[target='address']").modal("hide");
    });
    $("#baseinfo a[target='edit-education']").click(function(e) {
      e.preventDefault();
      $(".modal[target='education'] input[target='sharing']").prop("checked", false);
      $(".modal[target='education'] input[target='schoolname']").val("");
      $(".modal[target='education'] input[target='department']").val("");
      $(".modal[target='education'] input[target='degree']").val("");
      $(".modal[target='education'] input[target='top']").prop("checked", false);
      $(".modal[target='education'] div[target='confirm-message']").addClass("hide");
      $(".modal[target='education'] a[target='delete']").addClass("hide");
      $(".modal[target='education'] a[target='save']").attr("edit-type", "add");
      return $(".modal[target='education']").modal("show");
    });
    $(".modal[target='education'] a[target='save']").click(function(e) {
      var degree, department, edit_type, log_desc, original_degree, original_department, original_schoolname, original_top, request, schoolname, sharing, top;
      e.preventDefault();
      edit_type = $(this).attr("edit-type");
      schoolname = $(".modal[target='education'] input[target='schoolname']").val();
      department = $(".modal[target='education'] input[target='department']").val();
      degree = $(".modal[target='education'] input[target='degree']").val();
      top = $(".modal[target='education'] input[target='top']").prop("checked");
      sharing = "false";
      request = {
        Request: {
          EducationBackground: {
            SchoolName: schoolname,
            Department: department,
            Degree: degree,
            IsTop: top,
            IsSharing: sharing
          }
        }
      };
      if (edit_type === "update") {
        request.Request.EducationBackground.UID = $(this).attr('uid');
      }
      gadget.getContract("emba.student").send({
        service: edit_type === "add" ? "default.AddEducationBackground" : "default.UpdateEducationBackground",
        body: request,
        result: function(response, error, http) {
          if ((response.Result != null) && parseInt(response.Result.EffectRows, 10) > 0) {
            bind_education();
            return $(".modal[target='education']").modal("hide");
          }
        }
      });
      log_desc = "";
      if (edit_type === "update") {
        original_schoolname = $(".modal[target='education'] input[target='schoolname']").attr("original");
        original_department = $(".modal[target='education'] input[target='department']").attr("original");
        original_degree = $(".modal[target='education'] input[target='degree']").attr("original");
        original_top = $(".modal[target='education'] input[target='top']").attr("original");
        log_desc = "學校： " + original_schoolname + " -> " + schoolname + "\n系所： " + original_department + " -> " + department + "\n學位： " + original_degree + " -> " + degree + "\n最高學歷： " + (original_top === "t" ? "是" : "") + " -> " + (top === "true" ? "是" : "");
      } else {
        log_desc = "學校： " + schoolname + "\n系所： " + department + "\n學位： " + degree + "\n最高學歷： " + (top === "true" ? "是" : "");
      }
      return gadget.getContract("emba.student").send({
        service: "public.AddLog",
        body: {
          Request: {
            Log: {
              Actor: gadget.getContract("emba.student").getUserInfo().UserName,
              ActionType: edit_type === "update" ? "更新" : "新增",
              Action: edit_type === "update" ? "更新學歷" : "新增學歷",
              TargetCategory: "ischool.emba.education_background",
              ClientInfo: {
                ClientInfo: ""
              },
              ActionBy: "ischool web 個人資訊小工具",
              Description: log_desc
            }
          }
        }
      });
    });
    $(".modal[target='education'] a[target='delete']").click(function(e) {
      e.preventDefault();
      return $(".modal[target='education'] div[target='confirm-message']").removeClass("hide");
    });
    $(".modal[target='education'] a[target='confirm-cancel']").click(function(e) {
      e.preventDefault();
      return $(".modal[target='education'] div[target='confirm-message']").addClass("hide");
    });
    $(".modal[target='education'] a[target='confirm-accept']").click(function(e) {
      e.preventDefault();
      return gadget.getContract("emba.student").send({
        service: "default.RemoveEducationBackground",
        body: {
          Request: {
            EducationBackground: {
              UID: $(this).attr('uid')
            }
          }
        },
        result: function(response, error, http) {
          var log_desc, original_degree, original_department, original_schoolname, original_top;
          original_schoolname = $(".modal[target='education'] input[target='schoolname']").attr("original");
          original_department = $(".modal[target='education'] input[target='department']").attr("original");
          original_degree = $(".modal[target='education'] input[target='degree']").attr("original");
          original_top = $(".modal[target='education'] input[target='top']").attr("original");
          log_desc = "學校： " + original_schoolname + "\n系所： " + original_department + "\n學位： " + original_degree + "\n最高學歷： " + (original_top === "t" ? "是" : "");
          gadget.getContract("emba.student").send({
            service: "public.AddLog",
            body: {
              Request: {
                Log: {
                  Actor: gadget.getContract("emba.student").getUserInfo().UserName,
                  ActionType: "刪除",
                  Action: "刪除學歷",
                  TargetCategory: "ischool.emba.education_background",
                  ClientInfo: {
                    ClientInfo: ""
                  },
                  ActionBy: "ischool web 個人資訊小工具",
                  Description: log_desc
                }
              }
            }
          });
          if ((response.Result != null) && parseInt(response.Result.EffectRows, 10) > 0) {
            bind_education();
            return $(".modal[target='education']").modal("hide");
          }
        }
      });
    });
    $("#baseinfo a[target='edit-experience']").click(function(e) {
      e.preventDefault();
      $(".modal[target='experience'] form").validate().resetForm();
      $(".modal[target='experience'] .error").removeClass("error");
      $(".modal[target='experience'] input[target='sharing']").prop("checked", false);
      $(".modal[target='experience'] input[target='companyname']").val("");
      $(".modal[target='experience'] span[target='industry']").html("產業別");
      $(".modal[target='experience'] input[target='position']").val("");
      $(".modal[target='experience'] span[target='department']").html("部門");
      $(".modal[target='experience'] span[target='level']").html("層級別");
      $(".modal[target='experience'] span[target='place']").html("工作地點");
      $(".modal[target='experience'] span[target='status']").html("工作狀態");
      $(".modal[target='experience'] input[target='work_begin_date']").val("");
      $(".modal[target='experience'] input[target='work_end_date']").val("");
      $(".modal[target='experience'] input[target='publicist']").val("");
      $(".modal[target='experience'] input[target='public_relations_office_telephone']").val("");
      $(".modal[target='experience'] input[target='public_relations_office_fax']").val("");
      $(".modal[target='experience'] input[target='publicist_email']").val("");
      $(".modal[target='experience'] input[target='company_website']").val("");
      $(".modal[target='experience'] div[target='confirm-message']").addClass("hide");
      $(".modal[target='experience'] a[target='delete']").addClass("hide");
      $(".modal[target='experience'] a[target='save']").attr("edit-type", "add");
      return $(".modal[target='experience']").modal("show");
    });
    $(".modal[target='experience'] a[target='save']").click(function(e) {
      var company_website, companyname, department, edit_type, industry, level, log_desc, original_company_website, original_companyname, original_department, original_industry, original_level, original_place, original_position, original_public_relations_office_fax, original_public_relations_office_telephone, original_publicist, original_publicist_email, original_sharing, original_status, original_work_begin_date, original_work_end_date, place, position, public_relations_office_fax, public_relations_office_telephone, publicist, publicist_email, request, sharing, status, work_begin_date, work_end_date;
      e.preventDefault();
      if ($(".modal[target='experience'] form").valid()) {
        edit_type = $(this).attr("edit-type");
        companyname = $(".modal[target='experience'] input[target='companyname']").val();
        industry = $(".modal[target='experience'] span[target='industry']").html() !== "產業別" ? $(".modal[target='experience'] span[target='industry']").html() : "";
        position = $(".modal[target='experience'] input[target='position']").val();
        department = $(".modal[target='experience'] span[target='department']").html() !== "部門" ? $(".modal[target='experience'] span[target='department']").html() : "";
        level = $(".modal[target='experience'] span[target='level']").html() !== "層級別" ? $(".modal[target='experience'] span[target='level']").html() : "";
        place = $(".modal[target='experience'] span[target='place']").html() !== "工作地點" ? $(".modal[target='experience'] span[target='place']").html() : "";
        status = $(".modal[target='experience'] span[target='status']").html() !== "工作狀態" ? $(".modal[target='experience'] span[target='status']").html() : "";
        sharing = $(".modal[target='experience'] input[target='sharing']").prop("checked");
        work_begin_date = $(".modal[target='experience'] input[target='work_begin_date']").val();
        work_end_date = $(".modal[target='experience'] input[target='work_end_date']").val();
        publicist = $(".modal[target='experience'] input[target='publicist']").val();
        public_relations_office_telephone = $(".modal[target='experience'] input[target='public_relations_office_telephone']").val();
        public_relations_office_fax = $(".modal[target='experience'] input[target='public_relations_office_fax']").val();
        publicist_email = $(".modal[target='experience'] input[target='publicist_email']").val();
        company_website = $(".modal[target='experience'] input[target='company_website']").val();
        request = {
          Request: {
            Experience: {
              CompanyName: companyname,
              Industry: industry,
              Position: position,
              DepartmentCategory: department,
              PostLevel: level,
              WorkPlace: place,
              WorkStatus: status,
              IsSharing: sharing,
              WorkBeginDate: work_begin_date,
              WorkEndDate: work_end_date,
              Publicist: publicist,
              PublicRelationsOfficeTelephone: public_relations_office_telephone,
              PblicRelationsOfficeFax: public_relations_office_fax,
              PublicistEmail: publicist_email,
              CompanyWebsite: company_website
            }
          }
        };
        if (edit_type === "update") {
          request.Request.Experience.UID = $(this).attr('uid');
        }
        gadget.getContract("emba.student").send({
          service: edit_type === "add" ? "default.AddExperience" : "default.UpdateExperience",
          body: request,
          result: function(response, error, http) {
            if ((response.Result != null) && parseInt(response.Result.EffectRows, 10) > 0) {
              bind_experience();
              return $(".modal[target='experience']").modal("hide");
            }
          }
        });
        log_desc = "";
        if (edit_type === "update") {
          original_companyname = $(".modal[target='experience'] input[target='companyname']").attr("original");
          original_industry = $(".modal[target='experience'] span[target='industry']").attr("original");
          original_position = $(".modal[target='experience'] input[target='position']").attr("original");
          original_department = $(".modal[target='experience'] span[target='department']").attr("original");
          original_level = $(".modal[target='experience'] span[target='level']").attr("original");
          original_place = $(".modal[target='experience'] span[target='place']").attr("original");
          original_status = $(".modal[target='experience'] span[target='status']").attr("original");
          original_sharing = $(".modal[target='experience'] input[target='sharing']").attr("original");
          original_work_begin_date = $(".modal[target='experience'] input[target='work_begin_date']").attr("original");
          original_work_end_date = $(".modal[target='experience'] input[target='work_end_date']").attr("original");
          original_publicist = $(".modal[target='experience'] input[target='publicist']").attr("original");
          original_public_relations_office_telephone = $(".modal[target='experience'] input[target='public_relations_office_telephone']").attr("original");
          original_public_relations_office_fax = $(".modal[target='experience'] input[target='public_relations_office_fax']").attr("original");
          original_publicist_email = $(".modal[target='experience'] input[target='publicist_email']").attr("original");
          original_company_website = $(".modal[target='experience'] input[target='company_website']").attr("original");
          log_desc = "分享： " + (original_sharing === "t" ? "分享" : "不分享") + " -> " + (sharing === true ? "分享" : "不分享") + "\n公司： " + original_companyname + " -> " + companyname + "\n職稱： " + original_position + " -> " + position + "\n層級別： " + original_level + " -> " + level + "\n產業別： " + original_industry + " -> " + industry + "\n部門： " + original_department + " -> " + department + "\n工作地點： " + original_place + " -> " + place + "\n工作狀態： " + original_sharing + " -> " + sharing + "\n公關室電話： " + original_public_relations_office_telephone + " -> " + public_relations_office_telephone + "\n公關室傳真： " + original_public_relations_office_fax + " -> " + public_relations_office_fax + "\n對外公關姓名： " + original_publicist + " -> " + publicist + "\n對外公關EMAIL： " + original_publicist_email + " -> " + publicist_email + "\n公司網址： " + original_company_website + " -> " + company_website + "\n工作起日： " + original_work_begin_date + " -> " + work_begin_date + "\n工作迄日： " + original_work_end_date + " -> " + work_end_date;
        } else {
          log_desc = "分享： " + (sharing === "true" ? "分享" : "不分享") + "\n公司： " + companyname + "\n職稱： " + position + "\n層級別： " + level + "\n產業別： " + industry + "\n部門： " + department + "\n工作地點： " + place + "\n工作狀態： " + sharing + "\n公關室電話： " + public_relations_office_telephone + "\n公關室傳真： " + public_relations_office_fax + "\n對外公關姓名： " + publicist + "\n對外公關EMAIL： " + publicist_email + "\n公司網址： " + company_website + "\n工作起日： " + work_begin_date + "\n工作迄日： " + work_end_date;
        }
        return gadget.getContract("emba.student").send({
          service: "public.AddLog",
          body: {
            Request: {
              Log: {
                Actor: gadget.getContract("emba.student").getUserInfo().UserName,
                ActionType: edit_type === "update" ? "更新" : "新增",
                Action: edit_type === "update" ? "更新經歷" : "新增經歷",
                TargetCategory: "ischool.emba.experience",
                ClientInfo: {
                  ClientInfo: ""
                },
                ActionBy: "ischool web 個人資訊小工具",
                Description: log_desc
              }
            }
          }
        });
      } else {
        return $(".modal[target='experience'] .error:first input").focus();
      }
    });
    $(".modal[target='experience'] a[target='delete']").click(function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] div[target='confirm-message']").removeClass("hide");
    });
    $(".modal[target='experience'] a[target='confirm-cancel']").click(function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] div[target='confirm-message']").addClass("hide");
    });
    $(".modal[target='experience'] a[target='confirm-accept']").click(function(e) {
      e.preventDefault();
      return gadget.getContract("emba.student").send({
        service: "default.RemoveExperience",
        body: {
          Request: {
            Experience: {
              UID: $(this).attr('uid')
            }
          }
        },
        result: function(response, error, http) {
          var log_desc, original_company_website, original_companyname, original_department, original_industry, original_level, original_place, original_position, original_public_relations_office_fax, original_public_relations_office_telephone, original_publicist, original_publicist_email, original_sharing, original_status, original_work_begin_date, original_work_end_date;
          original_companyname = $(".modal[target='experience'] input[target='companyname']").attr("original");
          original_industry = $(".modal[target='experience'] span[target='industry']").attr("original");
          original_position = $(".modal[target='experience'] input[target='position']").attr("original");
          original_department = $(".modal[target='experience'] span[target='department']").attr("original");
          original_level = $(".modal[target='experience'] span[target='level']").attr("original");
          original_place = $(".modal[target='experience'] span[target='place']").attr("original");
          original_status = $(".modal[target='experience'] span[target='status']").attr("original");
          original_sharing = $(".modal[target='experience'] input[target='sharing']").attr("original");
          original_work_begin_date = $(".modal[target='experience'] input[target='work_begin_date']").attr("original");
          original_work_end_date = $(".modal[target='experience'] input[target='work_end_date']").attr("original");
          original_publicist = $(".modal[target='experience'] input[target='publicist']").attr("original");
          original_public_relations_office_telephone = $(".modal[target='experience'] input[target='public_relations_office_telephone']").attr("original");
          original_public_relations_office_fax = $(".modal[target='experience'] input[target='public_relations_office_fax']").attr("original");
          original_publicist_email = $(".modal[target='experience'] input[target='publicist_email']").attr("original");
          original_company_website = $(".modal[target='experience'] input[target='company_website']").attr("original");
          log_desc = "分享： " + (original_sharing === "t" ? "分享" : "不分享") + "\n公司： " + original_companyname + "\n職稱： " + original_position + "\n層級別： " + original_level + "\n產業別： " + original_industry + "\n部門： " + original_department + "\n工作地點： " + original_place + "\n工作狀態： " + original_sharing + "\n公關室電話： " + original_public_relations_office_telephone + "\n公關室傳真： " + original_public_relations_office_fax + "\n對外公關姓名： " + original_publicist + "\n對外公關EMAIL： " + original_publicist_email + "\n公司網址： " + original_company_website + "\n工作起日： " + original_work_begin_date + "\n工作迄日： " + original_work_end_date;
          gadget.getContract("emba.student").send({
            service: "public.AddLog",
            body: {
              Request: {
                Log: {
                  Actor: gadget.getContract("emba.student").getUserInfo().UserName,
                  ActionType: "刪除",
                  Action: "刪除經歷",
                  TargetCategory: "ischool.emba.experience",
                  ClientInfo: {
                    ClientInfo: ""
                  },
                  ActionBy: "ischool web 個人資訊小工具",
                  Description: log_desc
                }
              }
            }
          });
          if ((response.Result != null) && parseInt(response.Result.EffectRows, 10) > 0) {
            bind_experience();
            return $(".modal[target='experience']").modal("hide");
          }
        }
      });
    });
    $(".modal[target='experience']").on("click", "ul[target='industry-options'] a", function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] span[target='industry']").html($(this).html());
    });
    $(".modal[target='experience']").on("click", "ul[target='department-options'] a", function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] span[target='department']").html($(this).html());
    });
    $(".modal[target='experience']").on("click", "ul[target='level-options'] a", function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] span[target='level']").html($(this).html());
    });
    $(".modal[target='experience']").on("click", "ul[target='place-options'] a", function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] span[target='place']").html($(this).html());
    });
    $(".modal[target='experience']").on("click", "ul[target='status-options'] a", function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] span[target='status']").html($(this).html());
    });
    $(".modal[target='experience']").on("focus", "input.date:not(.hasDatepicker)", function() {
      return $(this).datepicker({
        dayNamesMin: ["日", "一", "二", "三", "四", "五", "六"],
        monthNames: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
        monthNamesShort: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
        dateFormat: "yy/mm/dd",
        changeMonth: true,
        changeYear: true,
        showButtonPanel: true,
        onSelect: function(dateStr) {
          return $(".modal[target='experience'] form").validate().element(this);
        }
      });
    });
    $("#baseinfo a[target='save-baseinfo']").click(function(e) {
      var log_desc1, log_desc2, request1, request2;
      e.preventDefault();
      if ($("#baseinfo form").valid()) {
        request1 = {
          Request: {
            Content: {
              EmailList: {
                email1: $("#baseinfo input[target='email1']").val(),
                email2: $("#baseinfo input[target='email2']").val(),
                email3: $("#baseinfo input[target='email3']").val(),
                email4: $("#baseinfo input[target='email4']").val(),
                email5: $("#baseinfo input[target='email5']").val()
              },
              DataSharing: {
                DataSharing: {
                  Name: "true",
                  Gender: "true",
                  Birthdate: !$("#baseinfo span[target='share-birthdate']").hasClass('hide'),
                  Custodian: !$("#baseinfo span[target='share-custodian-name']").hasClass('hide'),
                  CustodianPhone: !$("#baseinfo span[target='share-custodian-phone']").hasClass('hide'),
                  ContactPhone: "false",
                  PermanentPhone: !$("#baseinfo span[target='share-permanent-phone']").hasClass('hide'),
                  OtherPhoneList: {
                    PhoneNumber: [
                      {
                        "@text": !$("#baseinfo span[target='share-office-phone']").hasClass('hide') + '',
                        "@title": "公司電話"
                      }, {
                        "@text": !$("#baseinfo span[target='share-sms-phone2']").hasClass('hide') + '',
                        "@title": "行動電話2"
                      }, {
                        "@text": !$("#baseinfo span[target='share-other-phone']").hasClass('hide') + '',
                        "@title": "秘書電話"
                      }
                    ]
                  },
                  SMSPhone: !$("#baseinfo span[target='share-sms-phone1']").hasClass('hide'),
                  EmailList: {
                    Email1: !$("#baseinfo span[target='share-email1']").hasClass('hide'),
                    Email2: !$("#baseinfo span[target='share-email2']").hasClass('hide'),
                    Email3: !$("#baseinfo span[target='share-email3']").hasClass('hide'),
                    Email4: !$("#baseinfo span[target='share-email4']").hasClass('hide'),
                    Email5: !$("#baseinfo span[target='share-email5']").hasClass('hide')
                  },
                  ContactAddress: !$("#baseinfo span[target='share-contact-address']").hasClass('hide'),
                  PermanentAddress: !$("#baseinfo span[target='share-permanent-address']").hasClass('hide'),
                  OtherAddressList: {
                    Address: [!$("#baseinfo span[target='share-office-address']").hasClass('hide'), !$("#baseinfo span[target='share-office-address']").hasClass('hide'), !$("#baseinfo span[target='share-office-address']").hasClass('hide')]
                  }
                }
              }
            }
          }
        };
        request2 = {
          Request: {
            Content: {
              CustodianName: $("#baseinfo input[target='custodian-name']").val(),
              CustodianOtherInfo: {
                CustodianOtherInfo: {
                  Phone: $("#baseinfo input[target='custodian-phone']").val(),
                  Email: myInfo.CustodianOtherInfo.CustodianOtherInfo.Email,
                  Job: myInfo.CustodianOtherInfo.CustodianOtherInfo.Job,
                  EducationDegree: myInfo.CustodianOtherInfo.CustodianOtherInfo.EducationDegree,
                  Relationship: myInfo.CustodianOtherInfo.CustodianOtherInfo.Relationship
                }
              },
              ContactPhone: myInfo.ContactPhone,
              OtherPhones: {
                PhoneList: {
                  PhoneNumber: [$("#baseinfo input[target='office-phone']").val(), $("#baseinfo input[target='sms-phone2']").val(), $("#baseinfo input[target='other-phone']").val()]
                }
              },
              SMSPhone: $("#baseinfo input[target='sms-phone1']").val(),
              MailingAddress: {
                AddressList: {
                  Address: {
                    ZipCode: myInfo.MailingAddress.AddressList.Address.ZipCode || "",
                    County: myInfo.MailingAddress.AddressList.Address.County || "",
                    Town: myInfo.MailingAddress.AddressList.Address.Town || "",
                    District: myInfo.MailingAddress.AddressList.Address.District || "",
                    Area: myInfo.MailingAddress.AddressList.Address.Area || "",
                    DetailAddress: myInfo.MailingAddress.AddressList.Address.DetailAddress || ""
                  }
                }
              },
              OtherAddresses: {
                AddressList: {
                  Address: {
                    ZipCode: myInfo.OtherAddresses.AddressList.Address.ZipCode || "",
                    County: myInfo.OtherAddresses.AddressList.Address.County || "",
                    Town: myInfo.OtherAddresses.AddressList.Address.Town || "",
                    District: myInfo.OtherAddresses.AddressList.Address.District || "",
                    Area: myInfo.OtherAddresses.AddressList.Address.Area || "",
                    DetailAddress: myInfo.OtherAddresses.AddressList.Address.DetailAddress || ""
                  }
                }
              }
            }
          }
        };
        gadget.getContract("emba.student").send({
          service: "default.UpdateStudentBrief",
          body: request1,
          result: function(response, error, http) {
            if ((response.Result != null) && response.Result.EffectRows === "1") {
              return gadget.getContract("emba.student").send({
                service: "default.UpdateStudentInfo",
                body: request2,
                result: function(response, error, http) {
                  if ((response.Result != null) && response.Result.EffectRows === "1") {
                    bind_myinfo();
                    return alert("更新完成!");
                  }
                }
              });
            }
          }
        });
        log_desc1 = "性別： " + ($("#baseinfo span[target='share-gender']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-gender']").hasClass('hide')) + "\n出生日期： " + ($("#baseinfo span[target='share-birthdate']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-birthdate']").hasClass('hide')) + "\n緊急聯絡人： " + ($("#baseinfo span[target='share-custodian-name']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-custodian-name']").hasClass('hide')) + "\n聯絡人電話： " + ($("#baseinfo span[target='share-custodian-phone']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-custodian-phone']").hasClass('hide')) + "\n公司電話： " + ($("#baseinfo span[target='share-office-phone']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-office-phone']").hasClass('hide')) + "\n秘書電話： " + ($("#baseinfo span[target='share-other-phone']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-other-phone']").hasClass('hide')) + "\n行動電話 1： " + ($("#baseinfo span[target='share-sms-phone1']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-sms-phone1']").hasClass('hide')) + "\n行動電話 2： " + ($("#baseinfo span[target='share-sms-phone2']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-sms-phone2']").hasClass('hide')) + "\nE-MAIL 1： " + ($("#baseinfo span[target='share-email1']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-email1']").hasClass('hide')) + "\nE-MAIL 2： " + ($("#baseinfo span[target='share-email2']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-email2']").hasClass('hide')) + "\nE-MAIL 3： " + ($("#baseinfo span[target='share-email3']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-email3']").hasClass('hide')) + "\nE-MAIL 4： " + ($("#baseinfo span[target='share-email4']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-email4']").hasClass('hide')) + "\nE-MAIL 5： " + ($("#baseinfo span[target='share-email5']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-email5']").hasClass('hide')) + "\n聯絡地址： " + ($("#baseinfo span[target='share-contact-address']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-contact-address']").hasClass('hide')) + "\n公司地址： " + ($("#baseinfo span[target='share-office-address']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-office-address']").hasClass('hide'));
        gadget.getContract("emba.student").send({
          service: "public.AddLog",
          body: {
            Request: {
              Log: {
                Actor: gadget.getContract("emba.student").getUserInfo().UserName,
                ActionType: "更新",
                Action: "更新分享資料",
                TargetCategory: "ischool.emba.student_brief2",
                ClientInfo: {
                  ClientInfo: ""
                },
                ActionBy: "ischool web 個人資訊小工具",
                Description: log_desc1
              }
            }
          }
        });
        log_desc2 = "緊急聯絡人： " + ($("#baseinfo input[target='custodian-name']").attr("original")) + " -> " + ($("#baseinfo input[target='custodian-name']").val()) + "\n聯絡人電話： " + ($("#baseinfo input[target='custodian-phone']").attr("original")) + " -> " + ($("#baseinfo input[target='custodian-phone']").val()) + "\n公司電話： " + ($("#baseinfo input[target='office-phone']").attr("original")) + " -> " + ($("#baseinfo input[target='office-phone']").val()) + "\n秘書電話： " + ($("#baseinfo input[target='other-phone']").attr("original")) + " -> " + ($("#baseinfo input[target='other-phone']").val()) + "\n行動電話 1： " + ($("#baseinfo input[target='sms-phone1']").attr("original")) + " -> " + ($("#baseinfo input[target='sms-phone1']").val()) + "\n行動電話 2： " + ($("#baseinfo input[target='sms-phone2']").attr("original")) + " -> " + ($("#baseinfo input[target='sms-phone2']").val()) + "\nE-MAIL 1： " + ($("#baseinfo input[target='email1']").attr("original")) + " -> " + ($("#baseinfo input[target='email1']").val()) + "\nE-MAIL 2： " + ($("#baseinfo input[target='email2']").attr("original")) + " -> " + ($("#baseinfo input[target='email2']").val()) + "\nE-MAIL 3： " + ($("#baseinfo input[target='email3']").attr("original")) + " -> " + ($("#baseinfo input[target='email3']").val()) + "\nE-MAIL 4： " + ($("#baseinfo input[target='email4']").attr("original")) + " -> " + ($("#baseinfo input[target='email4']").val()) + "\nE-MAIL 5： " + ($("#baseinfo input[target='email5']").attr("original")) + " -> " + ($("#baseinfo input[target='email5']").val()) + "\n聯絡地址： " + ($("#baseinfo span[target='contact-address']").attr("original")) + " -> " + ($("#baseinfo span[target='contact-address']").html()) + "\n公司地址： " + ($("#baseinfo span[target='office-address']").attr("original")) + " -> " + ($("#baseinfo span[target='office-address']").val());
        return gadget.getContract("emba.student").send({
          service: "public.AddLog",
          body: {
            Request: {
              Log: {
                Actor: gadget.getContract("emba.student").getUserInfo().UserName,
                ActionType: "更新",
                Action: "更新個人資料",
                TargetCategory: "student",
                ClientInfo: {
                  ClientInfo: ""
                },
                ActionBy: "ischool web 個人資訊小工具",
                Description: log_desc2
              }
            }
          }
        });
      } else {
        return $("#baseinfo form .error:first input").focus();
      }
    });
    bind_data_source();
    bind_myinfo();
    return bind_education();
  });

  myInfo = null;

  bind_myinfo = function() {
    return gadget.getContract("emba.student").send({
      service: "default.GetMyInfo",
      body: "",
      result: function(response, error, http) {
        if (response.Result != null) {
          myInfo = response.Result;
          return gadget.getContract("emba.student").send({
            service: "default.GetStudentBrief",
            body: "",
            result: function(response, error, http) {
              var _ref;
              if (response.Result != null) {
                myInfo.EmailList = response.Result.EmailList;
                if (response.Result.EmailList === "") {
                  myInfo.EmailList = {
                    email1: "",
                    email2: "",
                    email3: "",
                    email4: "",
                    email5: ""
                  };
                }
                if (!(((_ref = response.Result.DataSharing) != null ? _ref.DataSharing : void 0) != null)) {
                  myInfo.DataSharing = {
                    Name: 'true',
                    Gender: 'true',
                    Birthdate: 'false',
                    Custodian: 'false',
                    CustodianPhone: 'false',
                    PermanentPhone: 'false',
                    ContactPhone: 'false',
                    SMSPhone: 'false',
                    OtherPhoneList: {
                      PhoneNumber: [
                        {
                          "@title": "公司電話",
                          "@text": 'false'
                        }, {
                          "@title": "行動電話2",
                          "@text": 'false'
                        }, {
                          "@title": "秘書電話",
                          "@text": 'false'
                        }
                      ]
                    },
                    PermanentAddress: 'false',
                    ContactAddress: 'false',
                    OtherAddressList: {
                      Address: ['false', 'false', 'false']
                    },
                    EmailList: {
                      Email1: 'false',
                      Email2: 'false',
                      Email3: 'false',
                      Email4: 'false',
                      Email5: 'false'
                    }
                  };
                } else {
                  myInfo.DataSharing = response.Result.DataSharing.DataSharing;
                }
                bind_baseinfo();
                return bind_address();
              }
            }
          });
        }
      }
    });
  };

  bind_baseinfo = function() {
    if (myInfo.CustodianOtherInfo === "") {
      myInfo.CustodianOtherInfo = {
        CustodianOtherInfo: {
          Phone: "",
          Email: "",
          Job: "",
          EducationDegree: "",
          Relationship: ""
        }
      };
    }
    myInfo.CustodianOtherInfo = {
      CustodianOtherInfo: {
        Phone: myInfo.CustodianOtherInfo.CustodianOtherInfo.Phone || "",
        Email: myInfo.CustodianOtherInfo.CustodianOtherInfo.Email || "",
        Job: myInfo.CustodianOtherInfo.CustodianOtherInfo.Job || "",
        EducationDegree: myInfo.CustodianOtherInfo.CustodianOtherInfo.EducationDegree || "",
        Relationship: myInfo.CustodianOtherInfo.CustodianOtherInfo.Relationship || ""
      }
    };
    $("#baseinfo span[target='share-name']").removeClass("hide");
    $("#baseinfo span[target='share-name']").attr("original", myInfo.DataSharing.Name);
    $("#baseinfo span[target='name']").html(myInfo.Name);
    $("#baseinfo span[target='name']").attr("original", myInfo.Name);
    $("#baseinfo span[target='share-gender']").removeClass("hide");
    $("#baseinfo span[target='share-gender']").attr("original", myInfo.DataSharing.Gender);
    $("#baseinfo span[target='gender']").html(myInfo.Gender);
    $("#baseinfo span[target='gender']").attr("original", myInfo.Gender);
    if (myInfo.DataSharing.Birthdate === "true") {
      $("#baseinfo span[target='share-birthdate']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.Birthdate === "true") {
      $("#baseinfo span[target='share-birthdate']").removeClass("hide");
    }
    $("#baseinfo span[target='share-birthdate']").attr("original", myInfo.DataSharing.Birthdate);
    if (myInfo.Birthdate !== "") {
      $("#baseinfo span[target='birthdate']").html(myInfo.Birthdate.substr(0, 10));
    }
    if (myInfo.Birthdate !== "") {
      $("#baseinfo span[target='birthdate']").attr("original", myInfo.Birthdate.substr(0, 10));
    }
    if (myInfo.DataSharing.Custodian === "true") {
      $("#baseinfo span[target='share-custodian-name']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.Custodian === "true") {
      $("#baseinfo span[target='share-custodian-name']").removeClass("hide");
    }
    $("#baseinfo span[target='share-custodian-name']").attr("original", myInfo.DataSharing.Custodian);
    $("#baseinfo input[target='custodian-name']").val(myInfo.CustodianName);
    $("#baseinfo input[target='custodian-name']").attr("original", myInfo.CustodianName);
    if (myInfo.DataSharing.CustodianPhone === "true") {
      $("#baseinfo span[target='share-custodian-phone']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.CustodianPhone === "true") {
      $("#baseinfo span[target='share-custodian-phone']").removeClass("hide");
    }
    $("#baseinfo span[target='share-custodian-phone']").attr("original", myInfo.DataSharing.CustodianPhone);
    $("#baseinfo input[target='custodian-phone']").val(myInfo.CustodianOtherInfo.CustodianOtherInfo.Phone);
    $("#baseinfo input[target='custodian-phone']").attr("original", myInfo.CustodianOtherInfo.CustodianOtherInfo.Phone);
    if (myInfo.DataSharing.PermanentPhone === "true") {
      $("#baseinfo span[target='share-permanent-phone']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.PermanentPhone === "true") {
      $("#baseinfo span[target='share-permanent-phone']").removeClass("hide");
    }
    $("#baseinfo span[target='share-permanent-phone']").attr("original", myInfo.DataSharing.PermanentPhone);
    $("#baseinfo span[target='permanent-phone']").html(myInfo.PermanentPhone);
    $("#baseinfo span[target='permanent-phone']").attr("original", myInfo.PermanentPhone);
    if (myInfo.DataSharing.OtherPhoneList.PhoneNumber[0]["@text"] === "true") {
      $("#baseinfo span[target='share-office-phone']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.OtherPhoneList.PhoneNumber[0]["@text"] === "true") {
      $("#baseinfo span[target='share-office-phone']").removeClass("hide");
    }
    $("#baseinfo span[target='share-office-phone']").attr("original", myInfo.DataSharing.OtherPhoneList.PhoneNumber[0]["@text"]);
    $("#baseinfo input[target='office-phone']").val(myInfo.OtherPhones.PhoneList.PhoneNumber[0]);
    $("#baseinfo input[target='office-phone']").attr("original", myInfo.OtherPhones.PhoneList.PhoneNumber[0]);
    if (myInfo.DataSharing.OtherPhoneList.PhoneNumber[2]["@text"] === "true") {
      $("#baseinfo span[target='share-other-phone']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.OtherPhoneList.PhoneNumber[2]["@text"] === "true") {
      $("#baseinfo span[target='share-other-phone']").removeClass("hide");
    }
    $("#baseinfo span[target='share-other-phone']").attr("original", myInfo.DataSharing.OtherPhoneList.PhoneNumber[2]["@text"]);
    $("#baseinfo input[target='other-phone']").val(myInfo.OtherPhones.PhoneList.PhoneNumber[2]);
    $("#baseinfo input[target='other-phone']").attr("original", myInfo.OtherPhones.PhoneList.PhoneNumber[2]);
    if (myInfo.DataSharing.SMSPhone === "true") {
      $("#baseinfo span[target='share-sms-phone1']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.SMSPhone === "true") {
      $("#baseinfo span[target='share-sms-phone1']").removeClass("hide");
    }
    $("#baseinfo span[target='share-sms-phone1']").attr("original", myInfo.DataSharing.SMSPhone);
    $("#baseinfo input[target='sms-phone1']").val(myInfo.SMSPhone);
    $("#baseinfo input[target='sms-phone1']").attr("original", myInfo.SMSPhone);
    if (myInfo.DataSharing.OtherPhoneList.PhoneNumber[1]["@text"] === "true") {
      $("#baseinfo span[target='share-sms-phone2']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.OtherPhoneList.PhoneNumber[1]["@text"] === "true") {
      $("#baseinfo span[target='share-sms-phone2']").removeClass("hide");
    }
    $("#baseinfo span[target='share-sms-phone2']").attr("original", myInfo.DataSharing.OtherPhoneList.PhoneNumber[1]["@text"]);
    $("#baseinfo input[target='sms-phone2']").val(myInfo.OtherPhones.PhoneList.PhoneNumber[1]);
    $("#baseinfo input[target='sms-phone2']").attr("original", myInfo.OtherPhones.PhoneList.PhoneNumber[1]);
    if (myInfo.DataSharing.EmailList["Email1"] === "true") {
      $("#baseinfo span[target='share-email1']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.EmailList["Email1"] === "true") {
      $("#baseinfo span[target='share-email1']").removeClass("hide");
    }
    $("#baseinfo span[target='share-email1']").attr("original", myInfo.DataSharing.EmailList["Email1"]);
    $("#baseinfo input[target='email1']").val(myInfo.EmailList["email1"]);
    $("#baseinfo input[target='email1']").attr("original", myInfo.EmailList["email1"]);
    if (myInfo.DataSharing.EmailList["Email2"] === "true") {
      $("#baseinfo span[target='share-email2']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.EmailList["Email2"] === "true") {
      $("#baseinfo span[target='share-email2']").removeClass("hide");
    }
    $("#baseinfo span[target='share-email2']").attr("original", myInfo.DataSharing.EmailList["Email2"]);
    $("#baseinfo input[target='email2']").val(myInfo.EmailList["email2"]);
    $("#baseinfo input[target='email2']").attr("original", myInfo.EmailList["email2"]);
    if (myInfo.DataSharing.EmailList["Email3"] === "true") {
      $("#baseinfo span[target='share-email3']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.EmailList["Email3"] === "true") {
      $("#baseinfo span[target='share-email3']").removeClass("hide");
    }
    $("#baseinfo span[target='share-email3']").attr("original", myInfo.DataSharing.EmailList["Email3"]);
    $("#baseinfo input[target='email3']").val(myInfo.EmailList["email3"]);
    $("#baseinfo input[target='email3']").attr("original", myInfo.EmailList["email3"]);
    if (myInfo.DataSharing.EmailList["Email4"] === "true") {
      $("#baseinfo span[target='share-email4']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.EmailList["Email4"] === "true") {
      $("#baseinfo span[target='share-email4']").removeClass("hide");
    }
    $("#baseinfo span[target='share-email4']").attr("original", myInfo.DataSharing.EmailList["Email4"]);
    $("#baseinfo input[target='email4']").val(myInfo.EmailList["email4"]);
    $("#baseinfo input[target='email4']").attr("original", myInfo.EmailList["email4"]);
    if (myInfo.DataSharing.EmailList["Email5"] === "true") {
      $("#baseinfo span[target='share-email5']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.EmailList["Email5"] === "true") {
      $("#baseinfo span[target='share-email5']").removeClass("hide");
    }
    $("#baseinfo span[target='share-email5']").attr("original", myInfo.DataSharing.EmailList["Email5"]);
    $("#baseinfo input[target='email5']").val(myInfo.EmailList["email5"]);
    $("#baseinfo input[target='email5']").attr("original", myInfo.EmailList["email5"]);
    if (myInfo.DataSharing.ContactAddress === "true") {
      $("#baseinfo span[target='share-contact-address']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.ContactAddress === "true") {
      $("#baseinfo span[target='share-contact-address']").removeClass("hide");
    }
    $("#baseinfo span[target='share-contact-address']").attr("original", myInfo.DataSharing.ContactAddress);
    $("#baseinfo span[target='contact-address']").html(myInfo.DataSharing.ContactAddress);
    $("#baseinfo span[target='contact-address']").attr("original", myInfo.DataSharing.ContactAddress);
    if (myInfo.DataSharing.PermanentAddress === "true") {
      $("#baseinfo span[target='share-permanent-address']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.PermanentAddress === "true") {
      $("#baseinfo span[target='share-permanent-address']").removeClass("hide");
    }
    $("#baseinfo span[target='share-permanent-address']").attr("original", myInfo.DataSharing.PermanentAddress);
    if (myInfo.DataSharing.OtherAddressList.Address[0] === "true") {
      $("#baseinfo span[target='share-office-address']").closest('div').removeClass("square");
    }
    if (myInfo.DataSharing.OtherAddressList.Address[0] === "true") {
      $("#baseinfo span[target='share-office-address']").removeClass("hide");
    }
    $("#baseinfo span[target='share-office-address']").attr("original", myInfo.DataSharing.OtherAddressList.Address[0]);
    return $("#baseinfo span[target='photo']").html("<img src='data:image/png;base64," + myInfo.FreshmanPhoto + "' style='width:80px'/>");
  };

  bind_address = function() {
    $("#baseinfo span[target='contact-address']").html("" + (myInfo.MailingAddress.AddressList.Address.ZipCode || '') + (myInfo.MailingAddress.AddressList.Address.County || '') + (myInfo.MailingAddress.AddressList.Address.Town || '') + (myInfo.MailingAddress.AddressList.Address.District || '') + (myInfo.MailingAddress.AddressList.Address.Area || '') + (myInfo.MailingAddress.AddressList.Address.DetailAddress || ''));
    $("#baseinfo span[target='contact-address']").attr("original", "" + (myInfo.MailingAddress.AddressList.Address.ZipCode || '') + (myInfo.MailingAddress.AddressList.Address.County || '') + (myInfo.MailingAddress.AddressList.Address.Town || '') + (myInfo.MailingAddress.AddressList.Address.District || '') + (myInfo.MailingAddress.AddressList.Address.Area || '') + (myInfo.MailingAddress.AddressList.Address.DetailAddress || ''));
    $("#baseinfo td[target='edit-contact-address']").click(function(e) {
      e.preventDefault();
      $(".modal[target='address'] .modal-header h3").html("編輯聯絡地址");
      $(".modal[target='address'] input[target='zipcode']").val(myInfo.MailingAddress.AddressList.Address.ZipCode || "");
      $(".modal[target='address'] input[target='county']").val(myInfo.MailingAddress.AddressList.Address.County || "");
      $(".modal[target='address'] input[target='town']").val(myInfo.MailingAddress.AddressList.Address.Town || "");
      $(".modal[target='address'] input[target='district']").val(myInfo.MailingAddress.AddressList.Address.District || "");
      $(".modal[target='address'] input[target='area']").val(myInfo.MailingAddress.AddressList.Address.Area || "");
      $(".modal[target='address'] input[target='detail']").val(myInfo.MailingAddress.AddressList.Address.DetailAddress || "");
      $(".modal[target='address'] a[target='accept']").attr("edit-type", "MailingAddress");
      return $(".modal[target='address']").modal("show");
    });
    $("#baseinfo span[target='permanent-address']").html("" + (myInfo.PermanentAddress.AddressList.Address.ZipCode || '') + (myInfo.PermanentAddress.AddressList.Address.County || '') + (myInfo.PermanentAddress.AddressList.Address.Town || '') + (myInfo.PermanentAddress.AddressList.Address.District || '') + (myInfo.PermanentAddress.AddressList.Address.Area || '') + (myInfo.PermanentAddress.AddressList.Address.DetailAddress || ''));
    $("#baseinfo span[target='permanent-address']").attr("original", "" + (myInfo.PermanentAddress.AddressList.Address.ZipCode || '') + (myInfo.PermanentAddress.AddressList.Address.County || '') + (myInfo.PermanentAddress.AddressList.Address.Town || '') + (myInfo.PermanentAddress.AddressList.Address.District || '') + (myInfo.PermanentAddress.AddressList.Address.Area || '') + (myInfo.PermanentAddress.AddressList.Address.DetailAddress || ''));
    $("#baseinfo span[target='office-address']").html("" + (myInfo.OtherAddresses.AddressList.Address.ZipCode || '') + (myInfo.OtherAddresses.AddressList.Address.County || '') + (myInfo.OtherAddresses.AddressList.Address.Town || '') + (myInfo.OtherAddresses.AddressList.Address.District || '') + (myInfo.OtherAddresses.AddressList.Address.Area || '') + (myInfo.OtherAddresses.AddressList.Address.DetailAddress || ''));
    $("#baseinfo span[target='office-address']").attr("original", "" + (myInfo.OtherAddresses.AddressList.Address.ZipCode || '') + (myInfo.OtherAddresses.AddressList.Address.County || '') + (myInfo.OtherAddresses.AddressList.Address.Town || '') + (myInfo.OtherAddresses.AddressList.Address.District || '') + (myInfo.OtherAddresses.AddressList.Address.Area || '') + (myInfo.OtherAddresses.AddressList.Address.DetailAddress || ''));
    return $("#baseinfo td[target='edit-office-address']").click(function(e) {
      e.preventDefault();
      $(".modal[target='address'] .modal-header h3").html("編輯公司地址");
      $(".modal[target='address'] input[target='zipcode']").val(myInfo.OtherAddresses.AddressList.Address.ZipCode || "");
      $(".modal[target='address'] input[target='county']").val(myInfo.OtherAddresses.AddressList.Address.County || "");
      $(".modal[target='address'] input[target='town']").val(myInfo.OtherAddresses.AddressList.Address.Town || "");
      $(".modal[target='address'] input[target='district']").val(myInfo.OtherAddresses.AddressList.Address.District || "");
      $(".modal[target='address'] input[target='area']").val(myInfo.OtherAddresses.AddressList.Address.Area || "");
      $(".modal[target='address'] input[target='detail']").val(myInfo.OtherAddresses.AddressList.Address.DetailAddress || "");
      $(".modal[target='address'] a[target='accept']").attr("edit-type", "OtherAddresses");
      return $(".modal[target='address']").modal("show");
    });
  };

  educations = [];

  bind_education = function() {
    return gadget.getContract("emba.student").send({
      service: "default.GetEducationBackground",
      body: "",
      result: function(response, error, http) {
        var items;
        items = [];
        if (response.Result != null) {
          educations = $(response.Result.EducationBackground);
          educations.each(function(index, item) {
            return items.push("<tr>\n	<td><span class=\"label label-important\" target=\"share-contact-address\"><i class=\"icon-\"></i></span></td>\n	<td>" + item.SchoolName + "</td>\n	<td>" + item.Department + "</td>\n	<td>" + item.Degree + "</td>\n	<td>" + (item.IsTop === "t" ? "是" : "") + "</td>\n	<td style='width:40px'><a href='#' class='btn btn-mini btn-inverse' index='" + index + "' target='edit'>編輯</a></td>\n</tr>");
          });
        }
        $("#baseinfo #education tbody").html(items.join(""));
        return $("#baseinfo #education a[target='edit']").click(function(e) {
          var index;
          e.preventDefault();
          index = parseInt($(this).attr("index"), 10);
          $(".modal[target='education'] input[target='schoolname']").val(educations[index].SchoolName);
          $(".modal[target='education'] input[target='schoolname']").attr("original", educations[index].SchoolName);
          $(".modal[target='education'] input[target='department']").val(educations[index].Department);
          $(".modal[target='education'] input[target='department']").attr("original", educations[index].Department);
          $(".modal[target='education'] input[target='degree']").val(educations[index].Degree);
          $(".modal[target='education'] input[target='degree']").attr("original", educations[index].Degree);
          $(".modal[target='education'] input[target='top']").prop("checked", educations[index].IsTop === "t");
          $(".modal[target='education'] input[target='top']").attr("original", educations[index].IsTop);
          $(".modal[target='education'] .modal-header h3").html("編輯學歷");
          $(".modal[target='education'] div[target='confirm-message']").addClass("hide");
          $(".modal[target='education'] a[target='delete']").removeClass("hide");
          $(".modal[target='education'] a[target='save']").attr("edit-type", "update");
          $(".modal[target='education'] a[target='save']").attr("uid", educations[index].UID);
          $(".modal[target='education'] a[target='confirm-accept']").attr("uid", educations[index].UID);
          return $(".modal[target='education']").modal("show");
        });
      }
    });
  };

  experiences = [];

  bind_experience = function() {
    return gadget.getContract("emba.student").send({
      service: "default.GetExperience",
      body: "",
      result: function(response, error, http) {
        var items;
        items = [];
        if (response.Result != null) {
          experiences = $(response.Result.Experience);
          experiences.each(function(index, item) {
            return items.push("<tr>\n                            <th class=\"myth\" style=\"width:30px\">分享</th>\n                            <th class=\"myth\">公司</th>\n                            <th class=\"myth\">職稱</th>\n                            <th class=\"myth\">層級別</th>\n                            <th class=\"myth\">產業別</th>\n                            <th class=\"myth\">部門</th>\n                            <th class=\"myth\">工作地點</th>\n                            <th class=\"myth\">工作狀態</th>\n                            <th class=\"myth\"></th>\n                        </tr>\n<tr>\n	" + (item.WorkStatus === "現職" ? item.IsSharing === "t" ? '<td target="data-sharing" rowspan="3"><span class="label label-info" data-action="share" index="' + index + '"><i class="icon-ok icon-white"></i></span></td>' : '<td target="data-sharing" rowspan="3"><div class="square" data-action="share" index="' + index + '"></div></td>' : '<td rowspan="3"><span class="label label-important" target="share-permanent-address"><i class="icon-"></i></span></td>') + "\n	<td>" + (item.CompanyName || '&nbsp;') + "</td>\n	<td>" + item.Position + "</td>\n	<td>" + item.PostLevel + "</td>\n	<td>" + item.Industry + "</td>\n	<td>" + item.DepartmentCategory + "</td>\n	<td>" + item.WorkPlace + "</td>\n	<td>" + item.WorkStatus + "</td>\n	<td rowspan=\"3\" style='width:40px'><a href='#' class='btn btn-mini btn-inverse' index='" + index + "' target='edit'>編輯</a></td>\n</tr>\n	                    <tr>\n	                        <th class=\"myth\">公關姓名</th>\n	                        <th class=\"myth\">公關室電話</th>\n	                        <th class=\"myth\">公關室傳真</th>\n	                        <th class=\"myth\">公關室email</th>\n	                        <th class=\"myth\">公司網址</th>\n	                        <th class=\"myth\">工作起日</th>\n	                        <th class=\"myth\">工作迄日</th>\n	                    </tr>\n	                    <tr>\n	<td>" + (item.Publicist || '&nbsp;') + "</td>\n	<td>" + item.PublicRelationsOfficeTelephone + "</td>\n	<td>" + item.PblicRelationsOfficeFax + "</td>\n	<td>" + item.PublicistEmail + "</td>\n	<td>" + item.CompanyWebsite + "</td>\n	<td>" + item.WorkBeginDate + "</td>\n	<td>" + item.WorkEndDate + "</td>\n</tr>");
          });
        }
        $("#baseinfo #experience tbody").html(items.join(""));
        $("#baseinfo #experience [data-action='share']").click(function(e) {
          return $("#baseinfo #experience a[target='edit']").filter("[index='" + ($(this).attr('index')) + "']").click();
        });
        return $("#baseinfo #experience a[target='edit']").click(function(e) {
          var index;
          e.preventDefault();
          $(".modal[target='experience'] form").validate().resetForm();
          $(".modal[target='experience'] .error").removeClass("error");
          index = parseInt($(this).attr("index"), 10);
          $(".modal[target='experience'] input[target='sharing']").prop("checked", experiences[index].IsSharing === "t");
          $(".modal[target='experience'] input[target='sharing']").attr("original", experiences[index].IsSharing);
          $(".modal[target='experience'] input[target='companyname']").val(experiences[index].CompanyName);
          $(".modal[target='experience'] input[target='companyname']").attr("original", experiences[index].CompanyName);
          $(".modal[target='experience'] span[target='industry']").html(experiences[index].Industry || "產業別");
          $(".modal[target='experience'] span[target='industry']").attr("original", experiences[index].Industry);
          $(".modal[target='experience'] input[target='position']").val(experiences[index].Position);
          $(".modal[target='experience'] input[target='position']").attr("original", experiences[index].Position);
          $(".modal[target='experience'] span[target='department']").html(experiences[index].DepartmentCategory || "部門");
          $(".modal[target='experience'] span[target='department']").attr("original", experiences[index].DepartmentCategory);
          $(".modal[target='experience'] span[target='level']").html(experiences[index].PostLevel || "層級別");
          $(".modal[target='experience'] span[target='level']").attr("original", experiences[index].PostLevel);
          $(".modal[target='experience'] span[target='place']").html(experiences[index].WorkPlace || "工作地點");
          $(".modal[target='experience'] span[target='place']").attr("original", experiences[index].WorkPlace);
          $(".modal[target='experience'] span[target='status']").html(experiences[index].WorkStatus || "工作狀態");
          $(".modal[target='experience'] span[target='status']").attr("original", experiences[index].WorkStatus);
          $(".modal[target='experience'] input[target='work_begin_date']").val(experiences[index].WorkBeginDate);
          $(".modal[target='experience'] input[target='work_begin_date']").attr("original", experiences[index].WorkBeginDate);
          $(".modal[target='experience'] input[target='work_end_date']").val(experiences[index].WorkEndDate);
          $(".modal[target='experience'] input[target='work_end_date']").attr("original", experiences[index].WorkEndDate);
          $(".modal[target='experience'] input[target='publicist']").val(experiences[index].Publicist);
          $(".modal[target='experience'] input[target='publicist']").attr("original", experiences[index].Publicist);
          $(".modal[target='experience'] input[target='public_relations_office_telephone']").val(experiences[index].PublicRelationsOfficeTelephone);
          $(".modal[target='experience'] input[target='public_relations_office_telephone']").attr("original", experiences[index].PublicRelationsOfficeTelephone);
          $(".modal[target='experience'] input[target='public_relations_office_fax']").val(experiences[index].PblicRelationsOfficeFax);
          $(".modal[target='experience'] input[target='public_relations_office_fax']").attr("original", experiences[index].PblicRelationsOfficeFax);
          $(".modal[target='experience'] input[target='publicist_email']").val(experiences[index].PublicistEmail);
          $(".modal[target='experience'] input[target='publicist_email']").attr("original", experiences[index].PublicistEmail);
          $(".modal[target='experience'] input[target='company_website']").val(experiences[index].CompanyWebsite);
          $(".modal[target='experience'] input[target='company_website']").attr("original", experiences[index].CompanyWebsite);
          $(".modal[target='experience'] .modal-header h3").html("編輯經歷");
          $(".modal[target='experience'] div[target='confirm-message']").addClass("hide");
          $(".modal[target='experience'] a[target='delete']").removeClass("hide");
          $(".modal[target='experience'] a[target='save']").attr("edit-type", "update");
          $(".modal[target='experience'] a[target='save']").attr("uid", experiences[index].UID);
          $(".modal[target='experience'] a[target='confirm-accept']").attr("uid", experiences[index].UID);
          return $(".modal[target='experience']").modal("show");
        });
      }
    });
  };

  bind_data_source = function() {
    return gadget.getContract("emba.student").send({
      service: "default.GetExperienceDataSource",
      body: {
        Request: {
          Condition: {
            NotDisplay: 'f'
          }
        }
      },
      result: function(response, error, http) {
        var data_source, options;
        options = {};
        if (response.Result != null) {
          data_source = $(response.Result.ExperienceDataSource);
          data_source.each(function(index, item) {
            if (!options[item.ItemCategory]) {
              options[item.ItemCategory] = [];
            }
            return options[item.ItemCategory].push("<li><a href=\"#\">" + (item.Item || '') + "</a></li>");
          });
          $(".modal[target='experience'] ul[target='level-options']").html(options['層級別'].join(""));
          $(".modal[target='experience'] ul[target='industry-options']").html(options['產業別'].join(""));
          $(".modal[target='experience'] ul[target='department-options']").html(options['部門類別'].join(""));
          $(".modal[target='experience'] ul[target='place-options']").html(options['工作地點'].join(""));
          $(".modal[target='experience'] ul[target='status-options']").html(options['工作狀態'].join(""));
          return bind_experience();
        }
      }
    });
  };

  $.validator.setDefaults({
    debug: false,
    errorElement: "span",
    errorClass: "help-inline",
    highlight: function(element) {
      return $(element).closest('.control-group').addClass("error");
    },
    unhighlight: function(element) {
      return $(element).closest('.control-group').removeClass("error");
    }
  });

  jQuery.validator.addMethod("ShareIncumbent", (function(value, element) {
    if ($(element).prop('checked')) {
      return $(".modal[target='experience'] span[target='status']").html() === '現職';
    } else {
      return true;
    }
  }), "現職才能勾選分享");

}).call(this);
