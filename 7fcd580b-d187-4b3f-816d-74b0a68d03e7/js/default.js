// Generated by CoffeeScript 1.3.1
(function() {
  var bind_academic, bind_address, bind_baseinfo, bind_education, bind_experience, bind_myinfo, bind_payment, educations, experiences, getCourseTeacherList, getCurrentCourse, getGraduationRequirement, getGraduationSubjectList, getSubjectSemesterScore, myInfo, query_absence;

  $(function() {
    $("td[target='data-sharing']").click(function(e) {
      e.preventDefault();
      return $(this).find("span").toggleClass("hide");
    });
    $(".modal[target='address'] a[target='accept']").click(function(e) {
      e.preventDefault();
      if ($(this).attr("edit-type") === "MailingAddress") {
        myInfo.MailingAddress.AddressList.Address.ZipCode = $(".modal[target='address'] input[target='zipcode']").val();
        myInfo.MailingAddress.AddressList.Address.County = $(".modal[target='address'] input[target='county']").val();
        myInfo.MailingAddress.AddressList.Address.Town = $(".modal[target='address'] input[target='town']").val();
        myInfo.MailingAddress.AddressList.Address.District = $(".modal[target='address'] input[target='district']").val();
        myInfo.MailingAddress.AddressList.Address.Area = $(".modal[target='address'] input[target='area']").val();
        myInfo.MailingAddress.AddressList.Address.DetailAddress = $(".modal[target='address'] input[target='detail']").val();
      }
      if ($(this).attr("edit-type") === "OtherAddresses") {
        myInfo.OtherAddresses.AddressList.Address.ZipCode = $(".modal[target='address'] input[target='zipcode']").val();
        myInfo.OtherAddresses.AddressList.Address.County = $(".modal[target='address'] input[target='county']").val();
        myInfo.OtherAddresses.AddressList.Address.Town = $(".modal[target='address'] input[target='town']").val();
        myInfo.OtherAddresses.AddressList.Address.District = $(".modal[target='address'] input[target='district']").val();
        myInfo.OtherAddresses.AddressList.Address.Area = $(".modal[target='address'] input[target='area']").val();
        myInfo.OtherAddresses.AddressList.Address.DetailAddress = $(".modal[target='address'] input[target='detail']").val();
      }
      bind_address();
      return $(".modal[target='address']").modal("hide");
    });
    $("#baseinfo a[target='edit-education']").click(function(e) {
      e.preventDefault();
      $(".modal[target='education'] input[target='sharing']").removeAttr("checked");
      $(".modal[target='education'] input[target='schoolname']").val("");
      $(".modal[target='education'] input[target='department']").val("");
      $(".modal[target='education'] input[target='degree']").val("");
      $(".modal[target='education'] input[target='top']").removeAttr("checked");
      $(".modal[target='education'] div[target='confirm-message']").addClass("hide");
      $(".modal[target='education'] a[target='delete']").addClass("hide");
      $(".modal[target='education'] a[target='save']").attr("edit-type", "add");
      return $(".modal[target='education']").modal("show");
    });
    $(".modal[target='education'] a[target='save']").click(function(e) {
      var degree, department, edit_type, log_desc, original_degree, original_department, original_schoolname, original_sharing, original_top, schoolname, sharing, top;
      e.preventDefault();
      edit_type = $(this).attr("edit-type");
      schoolname = $(".modal[target='education'] input[target='schoolname']").val();
      department = $(".modal[target='education'] input[target='department']").val();
      degree = $(".modal[target='education'] input[target='degree']").val();
      top = $(".modal[target='education'] input[target='top']").attr("checked") === "checked" ? "true" : "false";
      sharing = $(".modal[target='education'] input[target='sharing']").attr("checked") === "checked" ? "true" : "false";
      gadget.getContract("emba.student").send({
        service: edit_type === "add" ? "default.AddEducationBackground" : "default.UpdateEducationBackground",
        body: "<Request>\n	<EducationBackground>\n		<SchoolName>" + schoolname + "</SchoolName>\n		<Department>" + department + "</Department>\n		<Degree>" + degree + "</Degree>\n		<IsTop>" + top + "</IsTop>\n		<IsSharing>" + sharing + "</IsSharing>\n		" + (edit_type === "update" ? "<UID>" + ($(this).attr('uid')) + "</UID>" : "") + "\n	</EducationBackground>\n</Request>",
        result: function(response, error, http) {
          if ((response.Result != null) && parseInt(response.Result.EffectRows, 10) > 0) {
            bind_education();
            return $(".modal[target='education']").modal("hide");
          }
        }
      });
      log_desc = "";
      if (edit_type === "update") {
        original_schoolname = $(".modal[target='education'] input[target='schoolname']").attr("original");
        original_department = $(".modal[target='education'] input[target='department']").attr("original");
        original_degree = $(".modal[target='education'] input[target='degree']").attr("original");
        original_top = $(".modal[target='education'] input[target='top']").attr("original");
        original_sharing = $(".modal[target='education'] input[target='sharing']").attr("original");
        log_desc = "分享： " + (original_sharing === "t" ? "分享" : "不分享") + " -> " + (sharing === "true" ? "分享" : "不分享") + "\n學校： " + original_schoolname + " -> " + schoolname + "\n系所： " + original_department + " -> " + department + "\n學位： " + original_degree + " -> " + degree + "\n最高學歷： " + (original_top === "t" ? "是" : "") + " -> " + (top === "true" ? "是" : "");
      } else {
        log_desc = "分享： " + (sharing === "true" ? "分享" : "不分享") + "\n學校： " + schoolname + "\n系所： " + department + "\n學位： " + degree + "\n最高學歷： " + (top === "true" ? "是" : "");
      }
      return gadget.getContract("emba.student").send({
        service: "public.AddLog",
        body: "<Request>\n	<Log>\n		<Actor>" + (gadget.getContract("emba.student").getUserInfo().UserName) + "</Actor>\n		<ActionType>" + (edit_type === "update" ? "更新" : "新增") + "</ActionType>\n		<Action>" + (edit_type === "update" ? "更新學歷" : "新增學歷") + "</Action>\n		<TargetCategory>ischool.emba.education_background</TargetCategory>\n		<ClientInfo><ClientInfo></ClientInfo></ClientInfo>\n		<ActionBy>ischool web 個人資訊小工具</ActionBy>\n		<Description>" + log_desc + "</Description>\n	</Log>\n</Request>"
      });
    });
    $(".modal[target='education'] a[target='delete']").click(function(e) {
      e.preventDefault();
      return $(".modal[target='education'] div[target='confirm-message']").removeClass("hide");
    });
    $(".modal[target='education'] a[target='confirm-cancel']").click(function(e) {
      e.preventDefault();
      return $(".modal[target='education'] div[target='confirm-message']").addClass("hide");
    });
    $(".modal[target='education'] a[target='confirm-accept']").click(function(e) {
      e.preventDefault();
      return gadget.getContract("emba.student").send({
        service: "default.RemoveEducationBackground",
        body: "<Request>\n	<EducationBackground>\n		<UID>" + ($(this).attr('uid')) + "</UID>\n	</EducationBackground>\n</Request>",
        result: function(response, error, http) {
          if ((response.Result != null) && parseInt(response.Result.EffectRows, 10) > 0) {
            bind_education();
            return $(".modal[target='education']").modal("hide");
          }
        }
      });
    });
    $("#baseinfo a[target='edit-experience']").click(function(e) {
      e.preventDefault();
      $(".modal[target='experience'] input[target='sharing']").removeAttr("checked");
      $(".modal[target='experience'] input[target='companyname']").val("");
      $(".modal[target='experience'] span[target='industry']").html("產業別");
      $(".modal[target='experience'] input[target='position']").val("");
      $(".modal[target='experience'] span[target='department']").html("部門類別");
      $(".modal[target='experience'] span[target='level']").html("層級別");
      $(".modal[target='experience'] span[target='place']").html("工作地點");
      $(".modal[target='experience'] span[target='status']").html("工作狀態");
      $(".modal[target='experience'] div[target='confirm-message']").addClass("hide");
      $(".modal[target='experience'] a[target='delete']").addClass("hide");
      $(".modal[target='experience'] a[target='save']").attr("edit-type", "add");
      return $(".modal[target='experience']").modal("show");
    });
    $(".modal[target='experience'] a[target='save']").click(function(e) {
      var companyname, department, edit_type, industry, level, log_desc, original_companyname, original_department, original_industry, original_level, original_place, original_position, original_sharing, original_status, place, position, sharing, status;
      e.preventDefault();
      edit_type = $(this).attr("edit-type");
      companyname = $(".modal[target='experience'] input[target='companyname']").val();
      industry = $(".modal[target='experience'] span[target='industry']").html() !== "產業別" ? $(".modal[target='experience'] span[target='industry']").html() : "";
      position = $(".modal[target='experience'] input[target='position']").val();
      department = $(".modal[target='experience'] span[target='department']").html() !== "部門類別" ? $(".modal[target='experience'] span[target='department']").html() : "";
      level = $(".modal[target='experience'] span[target='level']").html() !== "層級別" ? $(".modal[target='experience'] span[target='level']").html() : "";
      place = $(".modal[target='experience'] span[target='place']").html() !== "工作地點" ? $(".modal[target='experience'] span[target='place']").html() : "";
      status = $(".modal[target='experience'] span[target='status']").html() !== "工作狀態" ? $(".modal[target='experience'] span[target='status']").html() : "";
      sharing = $(".modal[target='experience'] input[target='sharing']").attr("checked") === "checked" ? "true" : "false";
      gadget.getContract("emba.student").send({
        service: edit_type === "add" ? "default.AddExperience" : "default.UpdateExperience",
        body: "<Request>\n	<Experience>\n		<CompanyName>" + companyname + "</CompanyName>\n		<Industry>" + industry + "</Industry>\n		<Position>" + position + "</Position>\n		<DepartmentCategory>" + department + "</DepartmentCategory>\n		<PostLevel>" + level + "</PostLevel>\n		<WorkPlace>" + place + "</WorkPlace>\n		<WorkStatus>" + status + "</WorkStatus>\n		<IsSharing>" + sharing + "</IsSharing>\n		" + (edit_type === "update" ? "<UID>" + ($(this).attr('uid')) + "</UID>" : "") + "\n	</Experience>\n</Request>",
        result: function(response, error, http) {
          if ((response.Result != null) && parseInt(response.Result.EffectRows, 10) > 0) {
            bind_experience();
            return $(".modal[target='experience']").modal("hide");
          }
        }
      });
      log_desc = "";
      if (edit_type === "update") {
        original_companyname = $(".modal[target='experience'] input[target='companyname']").attr("original");
        original_industry = $(".modal[target='experience'] input[target='industry']").attr("original");
        original_position = $(".modal[target='experience'] input[target='position']").attr("original");
        original_department = $(".modal[target='experience'] input[target='department']").attr("original");
        original_level = $(".modal[target='experience'] input[target='level']").attr("original");
        original_place = $(".modal[target='experience'] input[target='place']").attr("original");
        original_status = $(".modal[target='experience'] input[target='status']").attr("original");
        original_sharing = $(".modal[target='experience'] input[target='sharing']").attr("original");
        log_desc = "分享： " + (original_sharing === "t" ? "分享" : "不分享") + " -> " + (sharing === "true" ? "分享" : "不分享") + "\n公司： " + original_companyname + " -> " + companyname + "\n產業別： " + original_industry + " -> " + industry + "\n部門： " + original_position + " -> " + position + "\n部門類別： " + original_department + " -> " + department + "\n層級別： " + original_level + " -> " + level + "\n工作地點： " + original_place + " -> " + place + "\n工作狀態： " + original_sharing + " -> " + sharing;
      } else {
        log_desc = "分享： " + (sharing === "true" ? "分享" : "不分享") + "\n公司： " + companyname + "\n產業別： " + industry + "\n部門： " + position + "\n部門類別： " + department + "\n層級別： " + level + "\n工作地點： " + place + "\n工作狀態： " + sharing;
      }
      return gadget.getContract("emba.student").send({
        service: "public.AddLog",
        body: "<Request>\n	<Log>\n		<Actor>" + (gadget.getContract("emba.student").getUserInfo().UserName) + "</Actor>\n		<ActionType>" + (edit_type === "update" ? "更新" : "新增") + "</ActionType>\n		<Action>" + (edit_type === "update" ? "更新經歷" : "新增經歷") + "</Action>\n		<TargetCategory>ischool.emba.experience</TargetCategory>\n		<ClientInfo><ClientInfo></ClientInfo></ClientInfo>\n		<ActionBy>ischool web 個人資訊小工具</ActionBy>\n		<Description>" + log_desc + "</Description>\n	</Log>\n</Request>"
      });
    });
    $(".modal[target='experience'] a[target='delete']").click(function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] div[target='confirm-message']").removeClass("hide");
    });
    $(".modal[target='experience'] a[target='confirm-cancel']").click(function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] div[target='confirm-message']").addClass("hide");
    });
    $(".modal[target='experience'] a[target='confirm-accept']").click(function(e) {
      e.preventDefault();
      return gadget.getContract("emba.student").send({
        service: "default.RemoveExperience",
        body: "<Request>\n	<Experience>\n		<UID>" + ($(this).attr('uid')) + "</UID>\n	</Experience>\n</Request>",
        result: function(response, error, http) {
          if ((response.Result != null) && parseInt(response.Result.EffectRows, 10) > 0) {
            bind_experience();
            return $(".modal[target='experience']").modal("hide");
          }
        }
      });
    });
    $(".modal[target='experience'] ul[target='industry-options'] a").click(function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] span[target='industry']").html($(this).html());
    });
    $(".modal[target='experience'] ul[target='department-options'] a").click(function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] span[target='department']").html($(this).html());
    });
    $(".modal[target='experience'] ul[target='level-options'] a").click(function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] span[target='level']").html($(this).html());
    });
    $(".modal[target='experience'] ul[target='place-options'] a").click(function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] span[target='place']").html($(this).html());
    });
    $(".modal[target='experience'] ul[target='status-options'] a").click(function(e) {
      e.preventDefault();
      return $(".modal[target='experience'] span[target='status']").html($(this).html());
    });
    $("#baseinfo a[target='save-baseinfo']").click(function(e) {
      var log_desc1, log_desc2, request1, request2;
      e.preventDefault();
      request1 = "<Request>\n	<Content>\n		<EmailList>\n			<email1>" + ($("#baseinfo span[target='email1']").html().replace(/<br>/gm, '')) + "</email1>\n			<email2>" + ($("#baseinfo span[target='email2']").html().replace(/<br>/gm, '')) + "</email2>\n			<email3>" + ($("#baseinfo span[target='email3']").html().replace(/<br>/gm, '')) + "</email3>\n			<email4>" + ($("#baseinfo span[target='email4']").html().replace(/<br>/gm, '')) + "</email4>\n			<email5>" + ($("#baseinfo span[target='email5']").html().replace(/<br>/gm, '')) + "</email5>\n		</EmailList>\n		<DataSharing>\n			<DataSharing>\n				<Name>true</Name>\n				<Gender>" + (!$("#baseinfo span[target='share-gender']").hasClass('hide')) + "</Gender>\n				<Birthdate>" + (!$("#baseinfo span[target='share-birthdate']").hasClass('hide')) + "</Birthdate>\n				<Custodian>" + (!$("#baseinfo span[target='share-custodian-name']").hasClass('hide')) + "</Custodian>\n				<CustodianPhone>" + (!$("#baseinfo span[target='share-custodian-phone']").hasClass('hide')) + "</CustodianPhone>\n				<ContactPhone>" + (!$("#baseinfo span[target='share-contact-phone']").hasClass('hide')) + "</ContactPhone>\n				<PermanentPhone>" + (!$("#baseinfo span[target='share-permanent-phone']").hasClass('hide')) + "</PermanentPhone>\n				<OtherPhoneList>\n					<PhoneNumber title='公司電話'>" + (!$("#baseinfo span[target='share-office-phone']").hasClass('hide')) + "</PhoneNumber>\n					<PhoneNumber title='行動電話2'>" + (!$("#baseinfo span[target='share-sms-phone2']").hasClass('hide')) + "</PhoneNumber>\n					<PhoneNumber title='秘書電話'>" + (!$("#baseinfo span[target='share-other-phone']").hasClass('hide')) + "</PhoneNumber>\n				</OtherPhoneList>\n				<SMSPhone>" + (!$("#baseinfo span[target='share-sms-phone1']").hasClass('hide')) + "</SMSPhone>\n				<EmailList>\n					<Email1>" + (!$("#baseinfo span[target='share-email1']").hasClass('hide')) + "</Email1>\n					<Email2>" + (!$("#baseinfo span[target='share-email2']").hasClass('hide')) + "</Email2>\n					<Email3>" + (!$("#baseinfo span[target='share-email3']").hasClass('hide')) + "</Email3>\n					<Email4>" + (!$("#baseinfo span[target='share-email4']").hasClass('hide')) + "</Email4>\n					<Email5>" + (!$("#baseinfo span[target='share-email5']").hasClass('hide')) + "</Email5>\n				</EmailList>\n				<ContactAddress>" + (!$("#baseinfo span[target='share-contact-address']").hasClass('hide')) + "</ContactAddress>\n				<PermanentAddress>" + (!$("#baseinfo span[target='share-permanent-address']").hasClass('hide')) + "</PermanentAddress>\n				<OtherAddressList>\n					<Address>" + (!$("#baseinfo span[target='share-office-address']").hasClass('hide')) + "</Address>\n					<Address>" + (!$("#baseinfo span[target='share-office-address']").hasClass('hide')) + "</Address>\n					<Address>" + (!$("#baseinfo span[target='share-office-address']").hasClass('hide')) + "</Address>\n				</OtherAddressList>\n			</DataSharing>\n		</DataSharing>\n	</Content>\n</Request>";
      request2 = "<Request>\n	<Content>\n		<CustodianName>" + ($("#baseinfo span[target='custodian-name']").html().replace(/<br>/gm, '')) + "</CustodianName>\n		<CustodianOtherInfo>\n			<CustodianOtherInfo>\n				<Phone>" + ($("#baseinfo span[target='custodian-phone']").html().replace(/<br>/gm, '')) + "</Phone>\n				<Email>" + myInfo.CustodianOtherInfo.CustodianOtherInfo.Email + "</Email>\n				<Job>" + myInfo.CustodianOtherInfo.CustodianOtherInfo.Job + "</Job>\n				<EducationDegree>" + myInfo.CustodianOtherInfo.CustodianOtherInfo.EducationDegree + "</EducationDegree>\n				<Relationship>" + myInfo.CustodianOtherInfo.CustodianOtherInfo.Relationship + "</Relationship>\n			</CustodianOtherInfo>\n		</CustodianOtherInfo>\n		<ContactPhone>" + ($("#baseinfo span[target='contact-phone']").html().replace(/<br>/gm, '')) + "</ContactPhone>\n		<OtherPhones>\n			<PhoneList>\n				<PhoneNumber>" + ($("#baseinfo span[target='office-phone']").html().replace(/<br>/gm, '')) + "</PhoneNumber>\n				<PhoneNumber>" + ($("#baseinfo span[target='sms-phone2']").html().replace(/<br>/gm, '')) + "</PhoneNumber>\n				<PhoneNumber>" + ($("#baseinfo span[target='other-phone']").html().replace(/<br>/gm, '')) + "</PhoneNumber>\n			</PhoneList>\n		</OtherPhones>\n		<SMSPhone>" + ($("#baseinfo span[target='sms-phone1']").html().replace(/<br>/gm, '')) + "</SMSPhone>\n		<MailingAddress>\n			<AddressList>\n				<Address>\n					<ZipCode>" + (myInfo.MailingAddress.AddressList.Address.ZipCode || "") + "</ZipCode>\n					<County>" + (myInfo.MailingAddress.AddressList.Address.County || "") + "</County>\n					<Town>" + (myInfo.MailingAddress.AddressList.Address.Town || "") + "</Town>\n					<District>" + (myInfo.MailingAddress.AddressList.Address.District || "") + "</District>\n					<Area>" + (myInfo.MailingAddress.AddressList.Address.Area || "") + "</Area>\n					<DetailAddress>" + (myInfo.MailingAddress.AddressList.Address.DetailAddress || "") + "</DetailAddress>\n				</Address>\n			</AddressList>\n		</MailingAddress>\n		<OtherAddresses>\n			<AddressList>\n				<Address>\n					<ZipCode>" + (myInfo.OtherAddresses.AddressList.Address.ZipCode || "") + "</ZipCode>\n					<County>" + (myInfo.OtherAddresses.AddressList.Address.County || "") + "</County>\n					<Town>" + (myInfo.OtherAddresses.AddressList.Address.Town || "") + "</Town>\n					<District>" + (myInfo.OtherAddresses.AddressList.Address.District || "") + "</District>\n					<Area>" + (myInfo.OtherAddresses.AddressList.Address.Area || "") + "</Area>\n					<DetailAddress>" + (myInfo.OtherAddresses.AddressList.Address.DetailAddress || "") + "</DetailAddress>\n				</Address>\n			</AddressList>\n		</OtherAddresses>\n	</Content>\n</Request>";
      gadget.getContract("emba.student").send({
        service: "default.UpdateStudentBrief",
        body: request1,
        result: function(response, error, http) {
          if ((response.Result != null) && response.Result.EffectRows === "1") {
            return gadget.getContract("emba.student").send({
              service: "default.UpdateStudentInfo",
              body: request2,
              result: function(response, error, http) {
                if ((response.Result != null) && response.Result.EffectRows === "1") {
                  bind_myinfo();
                  return alert("更新完成!");
                }
              }
            });
          }
        }
      });
      log_desc1 = "性別： " + ($("#baseinfo span[target='share-gender']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-gender']").hasClass('hide')) + "\n出生日期： " + ($("#baseinfo span[target='share-birthdate']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-birthdate']").hasClass('hide')) + "\n緊急聯絡人： " + ($("#baseinfo span[target='share-custodian-name']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-custodian-name']").hasClass('hide')) + "\n聯絡人電話： " + ($("#baseinfo span[target='share-custodian-phone']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-custodian-phone']").hasClass('hide')) + "\n聯絡電話： " + ($("#baseinfo span[target='share-contact-phone']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-contact-phone']").hasClass('hide')) + "\n公司電話： " + ($("#baseinfo span[target='share-office-phone']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-office-phone']").hasClass('hide')) + "\n秘書電話： " + ($("#baseinfo span[target='share-other-phone']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-other-phone']").hasClass('hide')) + "\n行動電話 1： " + ($("#baseinfo span[target='share-sms-phone1']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-sms-phone1']").hasClass('hide')) + "\n行動電話 2： " + ($("#baseinfo span[target='share-sms-phone2']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-sms-phone2']").hasClass('hide')) + "\nE-MAIL 1： " + ($("#baseinfo span[target='share-email1']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-email1']").hasClass('hide')) + "\nE-MAIL 2： " + ($("#baseinfo span[target='share-email2']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-email2']").hasClass('hide')) + "\nE-MAIL 3： " + ($("#baseinfo span[target='share-email3']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-email3']").hasClass('hide')) + "\nE-MAIL 4： " + ($("#baseinfo span[target='share-email4']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-email4']").hasClass('hide')) + "\nE-MAIL 5： " + ($("#baseinfo span[target='share-email5']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-email5']").hasClass('hide')) + "\n聯絡地址： " + ($("#baseinfo span[target='share-contact-address']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-contact-address']").hasClass('hide')) + "\n公司地址： " + ($("#baseinfo span[target='share-office-address']").attr("original")) + " -> " + (!$("#baseinfo span[target='share-office-address']").hasClass('hide'));
      gadget.getContract("emba.student").send({
        service: "public.AddLog",
        body: "<Request>\n	<Log>\n		<Actor>" + (gadget.getContract("emba.student").getUserInfo().UserName) + "</Actor>\n		<ActionType>更新</ActionType>\n		<Action>更新分享資料</Action>\n		<TargetCategory>ischool.emba.student_brief2</TargetCategory>\n		<ClientInfo><ClientInfo></ClientInfo></ClientInfo>\n		<ActionBy>ischool web 個人資訊小工具</ActionBy>\n		<Description>" + log_desc1 + "</Description>\n	</Log>\n</Request>"
      });
      log_desc2 = "緊急聯絡人： " + ($("#baseinfo span[target='custodian-name']").attr("original")) + " -> " + ($("#baseinfo span[target='custodian-name']").html().replace(/<br>/gm, '')) + "\n聯絡人電話： " + ($("#baseinfo span[target='custodian-phone']").attr("original")) + " -> " + ($("#baseinfo span[target='custodian-phone']").html().replace(/<br>/gm, '')) + "\n聯絡電話： " + ($("#baseinfo span[target='contact-phone']").attr("original")) + " -> " + ($("#baseinfo span[target='contact-phone']").html().replace(/<br>/gm, '')) + "\n公司電話： " + ($("#baseinfo span[target='office-phone']").attr("original")) + " -> " + ($("#baseinfo span[target='office-phone']").html().replace(/<br>/gm, '')) + "\n秘書電話： " + ($("#baseinfo span[target='other-phone']").attr("original")) + " -> " + ($("#baseinfo span[target='other-phone']").html().replace(/<br>/gm, '')) + "\n行動電話 1： " + ($("#baseinfo span[target='sms-phone1']").attr("original")) + " -> " + ($("#baseinfo span[target='sms-phone1']").html().replace(/<br>/gm, '')) + "\n行動電話 2： " + ($("#baseinfo span[target='sms-phone2']").attr("original")) + " -> " + ($("#baseinfo span[target='sms-phone2']").html().replace(/<br>/gm, '')) + "\nE-MAIL 1： " + ($("#baseinfo span[target='email1']").attr("original")) + " -> " + ($("#baseinfo span[target='email1']").html().replace(/<br>/gm, '')) + "\nE-MAIL 2： " + ($("#baseinfo span[target='email2']").attr("original")) + " -> " + ($("#baseinfo span[target='email2']").html().replace(/<br>/gm, '')) + "\nE-MAIL 3： " + ($("#baseinfo span[target='email3']").attr("original")) + " -> " + ($("#baseinfo span[target='email3']").html().replace(/<br>/gm, '')) + "\nE-MAIL 4： " + ($("#baseinfo span[target='email4']").attr("original")) + " -> " + ($("#baseinfo span[target='email4']").html().replace(/<br>/gm, '')) + "\nE-MAIL 5： " + ($("#baseinfo span[target='email5']").attr("original")) + " -> " + ($("#baseinfo span[target='email5']").html().replace(/<br>/gm, '')) + "\n聯絡地址： " + ($("#baseinfo span[target='contact-address']").attr("original")) + " -> " + ($("#baseinfo span[target='contact-address']").html()) + "\n公司地址： " + ($("#baseinfo span[target='office-address']").attr("original")) + " -> " + ($("#baseinfo span[target='office-address']").html().replace(/<br>/gm, ''));
      return gadget.getContract("emba.student").send({
        service: "public.AddLog",
        body: "<Request>\n	<Log>\n		<Actor>" + (gadget.getContract("emba.student").getUserInfo().UserName) + "</Actor>\n		<ActionType>更新</ActionType>\n		<Action>更新個人資料</Action>\n		<TargetCategory>student</TargetCategory>\n		<ClientInfo><ClientInfo></ClientInfo></ClientInfo>\n		<ActionBy>ischool web 個人資訊小工具</ActionBy>\n		<Description>" + log_desc2 + "</Description>\n	</Log>\n</Request>"
      });
    });
    $("#absence a[target='query']").click(function(e) {
      e.preventDefault();
      return query_absence();
    });
    $("#absence ul[target='semester-options'] a").click(function(e) {
      e.preventDefault();
      $("#absence span[target='semester']").html($(this).html());
      return $("#absence span[target='semester']").attr("value", $(this).attr("value"));
    });
    gadget.getContract("emba.student").send({
      service: "default.GetSemester",
      body: "",
      result: function(response, error, http) {
        var semester;
        $("#absence input[target='schoolYear']").val(response.Result.SystemConfig.DefaultSchoolYear);
        semester = response.Result.SystemConfig.DefaultSemester;
        $("#absence span[target='semester']").attr("value", semester);
        if (semester === "0") {
          semester = "暑期";
        }
        if (semester === "1") {
          semester = "第 1 學期";
        }
        if (semester === "2") {
          semester = "第 2 學期";
        }
        return $("#absence span[target='semester']").html(semester);
      }
    });
    bind_myinfo();
    bind_education();
    bind_experience();
    bind_academic();
    return bind_payment();
  });

  myInfo = null;

  bind_myinfo = function() {
    return gadget.getContract("emba.student").send({
      service: "default.GetMyInfo",
      body: "",
      result: function(response, error, http) {
        if (response.Result != null) {
          myInfo = response.Result;
          if (myInfo.Status === "在學" || myInfo.Status === "休學") {
            $("#payment #payment-message").addClass("hide");
          }
          return gadget.getContract("emba.student").send({
            service: "default.GetStudentBrief",
            body: "",
            result: function(response, error, http) {
              var _ref;
              if (response.Result != null) {
                myInfo.EmailList = response.Result.EmailList;
                if (response.Result.EmailList === "") {
                  myInfo.EmailList = {
                    email1: "",
                    email2: "",
                    email3: "",
                    email4: "",
                    email5: ""
                  };
                }
                if (!(((_ref = response.Result.DataSharing) != null ? _ref.DataSharing : void 0) != null)) {
                  myInfo.DataSharing = {
                    Name: 'true',
                    Gender: 'false',
                    Birthdate: 'false',
                    Custodian: 'false',
                    CustodianPhone: 'false',
                    PermanentPhone: 'false',
                    ContactPhone: 'false',
                    SMSPhone: 'false',
                    OtherPhoneList: {
                      PhoneNumber: [
                        {
                          "@title": "公司電話",
                          "@text": 'false'
                        }, {
                          "@title": "行動電話2",
                          "@text": 'false'
                        }, {
                          "@title": "秘書電話",
                          "@text": 'false'
                        }
                      ]
                    },
                    PermanentAddress: 'false',
                    ContactAddress: 'false',
                    OtherAddressList: {
                      Address: ['false', 'false', 'false']
                    },
                    EmailList: {
                      Email1: 'false',
                      Email2: 'false',
                      Email3: 'false',
                      Email4: 'false',
                      Email5: 'false'
                    }
                  };
                } else {
                  myInfo.DataSharing = response.Result.DataSharing.DataSharing;
                }
                bind_baseinfo();
                return bind_address();
              }
            }
          });
        }
      }
    });
  };

  bind_baseinfo = function() {
    if (myInfo.CustodianOtherInfo === "") {
      myInfo.CustodianOtherInfo = {
        CustodianOtherInfo: {
          Phone: "",
          Email: "",
          Job: "",
          EducationDegree: "",
          Relationship: ""
        }
      };
    }
    myInfo.CustodianOtherInfo = {
      CustodianOtherInfo: {
        Phone: myInfo.CustodianOtherInfo.CustodianOtherInfo.Phone || "",
        Email: myInfo.CustodianOtherInfo.CustodianOtherInfo.Email || "",
        Job: myInfo.CustodianOtherInfo.CustodianOtherInfo.Job || "",
        EducationDegree: myInfo.CustodianOtherInfo.CustodianOtherInfo.EducationDegree || "",
        Relationship: myInfo.CustodianOtherInfo.CustodianOtherInfo.Relationship || ""
      }
    };
    $("#baseinfo span[target='share-name']").removeClass("hide");
    $("#baseinfo span[target='share-name']").attr("original", myInfo.DataSharing.Name);
    $("#baseinfo span[target='name']").html(myInfo.Name);
    $("#baseinfo span[target='name']").attr("original", myInfo.Name);
    if (myInfo.DataSharing.Gender === "true") {
      $("#baseinfo span[target='share-gender']").removeClass("hide");
    }
    $("#baseinfo span[target='share-gender']").attr("original", myInfo.DataSharing.Gender);
    $("#baseinfo span[target='gender']").html(myInfo.Gender);
    $("#baseinfo span[target='gender']").attr("original", myInfo.Gender);
    if (myInfo.DataSharing.Birthdate === "true") {
      $("#baseinfo span[target='share-birthdate']").removeClass("hide");
    }
    $("#baseinfo span[target='share-birthdate']").attr("original", myInfo.DataSharing.Birthdate);
    if (myInfo.Birthdate !== "") {
      $("#baseinfo span[target='birthdate']").html(myInfo.Birthdate.substr(0, 10));
    }
    if (myInfo.Birthdate !== "") {
      $("#baseinfo span[target='birthdate']").attr("original", myInfo.Birthdate.substr(0, 10));
    }
    if (myInfo.DataSharing.Custodian === "true") {
      $("#baseinfo span[target='share-custodian-name']").removeClass("hide");
    }
    $("#baseinfo span[target='share-custodian-name']").attr("original", myInfo.DataSharing.Custodian);
    $("#baseinfo span[target='custodian-name']").html(myInfo.CustodianName);
    $("#baseinfo span[target='custodian-name']").attr("original", myInfo.CustodianName);
    if (myInfo.DataSharing.CustodianPhone === "true") {
      $("#baseinfo span[target='share-custodian-phone']").removeClass("hide");
    }
    $("#baseinfo span[target='share-custodian-phone']").attr("original", myInfo.DataSharing.CustodianPhone);
    $("#baseinfo span[target='custodian-phone']").html(myInfo.CustodianOtherInfo.CustodianOtherInfo.Phone);
    $("#baseinfo span[target='custodian-phone']").attr("original", myInfo.CustodianOtherInfo.CustodianOtherInfo.Phone);
    if (myInfo.DataSharing.ContactPhone === "true") {
      $("#baseinfo span[target='share-contact-phone']").removeClass("hide");
    }
    $("#baseinfo span[target='share-contact-phone']").attr("original", myInfo.DataSharing.ContactPhone);
    $("#baseinfo span[target='contact-phone']").html(myInfo.ContactPhone);
    $("#baseinfo span[target='contact-phone']").attr("original", myInfo.ContactPhone);
    if (myInfo.DataSharing.PermanentPhone === "true") {
      $("#baseinfo span[target='share-permanent-phone']").removeClass("hide");
    }
    $("#baseinfo span[target='share-permanent-phone']").attr("original", myInfo.DataSharing.PermanentPhone);
    $("#baseinfo span[target='permanent-phone']").html(myInfo.PermanentPhone);
    $("#baseinfo span[target='permanent-phone']").attr("original", myInfo.PermanentPhone);
    if (myInfo.DataSharing.OtherPhoneList.PhoneNumber[0]["@text"] === "true") {
      $("#baseinfo span[target='share-office-phone']").removeClass("hide");
    }
    $("#baseinfo span[target='share-office-phone']").attr("original", myInfo.DataSharing.OtherPhoneList.PhoneNumber[0]["@text"]);
    $("#baseinfo span[target='office-phone']").html(myInfo.OtherPhones.PhoneList.PhoneNumber[0]);
    $("#baseinfo span[target='office-phone']").attr("original", myInfo.OtherPhones.PhoneList.PhoneNumber[0]);
    if (myInfo.DataSharing.OtherPhoneList.PhoneNumber[2]["@text"] === "true") {
      $("#baseinfo span[target='share-other-phone']").removeClass("hide");
    }
    $("#baseinfo span[target='share-other-phone']").attr("original", myInfo.DataSharing.OtherPhoneList.PhoneNumber[2]["@text"]);
    $("#baseinfo span[target='other-phone']").html(myInfo.OtherPhones.PhoneList.PhoneNumber[2]);
    $("#baseinfo span[target='other-phone']").attr("original", myInfo.OtherPhones.PhoneList.PhoneNumber[2]);
    if (myInfo.DataSharing.SMSPhone === "true") {
      $("#baseinfo span[target='share-sms-phone1']").removeClass("hide");
    }
    $("#baseinfo span[target='share-sms-phone1']").attr("original", myInfo.DataSharing.SMSPhone);
    $("#baseinfo span[target='sms-phone1']").html(myInfo.SMSPhone);
    $("#baseinfo span[target='sms-phone1']").attr("original", myInfo.SMSPhone);
    if (myInfo.DataSharing.OtherPhoneList.PhoneNumber[1]["@text"] === "true") {
      $("#baseinfo span[target='share-sms-phone2']").removeClass("hide");
    }
    $("#baseinfo span[target='share-sms-phone2']").attr("original", myInfo.DataSharing.OtherPhoneList.PhoneNumber[1]["@text"]);
    $("#baseinfo span[target='sms-phone2']").html(myInfo.OtherPhones.PhoneList.PhoneNumber[1]);
    $("#baseinfo span[target='sms-phone2']").attr("original", myInfo.OtherPhones.PhoneList.PhoneNumber[1]);
    if (myInfo.DataSharing.EmailList["Email1"] === "true") {
      $("#baseinfo span[target='share-email1']").removeClass("hide");
    }
    $("#baseinfo span[target='share-email1']").attr("original", myInfo.DataSharing.EmailList["Email1"]);
    $("#baseinfo span[target='email1']").html(myInfo.EmailList["email1"]);
    $("#baseinfo span[target='email1']").attr("original", myInfo.EmailList["email1"]);
    if (myInfo.DataSharing.EmailList["Email2"] === "true") {
      $("#baseinfo span[target='share-email2']").removeClass("hide");
    }
    $("#baseinfo span[target='share-email2']").attr("original", myInfo.DataSharing.EmailList["Email2"]);
    $("#baseinfo span[target='email2']").html(myInfo.EmailList["email2"]);
    $("#baseinfo span[target='email2']").attr("original", myInfo.EmailList["email2"]);
    if (myInfo.DataSharing.EmailList["Email3"] === "true") {
      $("#baseinfo span[target='share-email3']").removeClass("hide");
    }
    $("#baseinfo span[target='share-email3']").attr("original", myInfo.DataSharing.EmailList["Email3"]);
    $("#baseinfo span[target='email3']").html(myInfo.EmailList["email3"]);
    $("#baseinfo span[target='email3']").attr("original", myInfo.EmailList["email3"]);
    if (myInfo.DataSharing.EmailList["Email4"] === "true") {
      $("#baseinfo span[target='share-email4']").removeClass("hide");
    }
    $("#baseinfo span[target='share-email4']").attr("original", myInfo.DataSharing.EmailList["Email4"]);
    $("#baseinfo span[target='email4']").html(myInfo.EmailList["email4"]);
    $("#baseinfo span[target='email4']").attr("original", myInfo.EmailList["email4"]);
    if (myInfo.DataSharing.EmailList["Email5"] === "true") {
      $("#baseinfo span[target='share-email5']").removeClass("hide");
    }
    $("#baseinfo span[target='share-email5']").attr("original", myInfo.DataSharing.EmailList["Email5"]);
    $("#baseinfo span[target='email5']").html(myInfo.EmailList["email5"]);
    $("#baseinfo span[target='email5']").attr("original", myInfo.EmailList["email5"]);
    if (myInfo.DataSharing.ContactAddress === "true") {
      $("#baseinfo span[target='share-contact-address']").removeClass("hide");
    }
    $("#baseinfo span[target='share-contact-address']").attr("original", myInfo.DataSharing.ContactAddress);
    if (myInfo.DataSharing.PermanentAddress === "true") {
      $("#baseinfo span[target='share-permanent-address']").removeClass("hide");
    }
    $("#baseinfo span[target='share-permanent-address']").attr("original", myInfo.DataSharing.PermanentAddress);
    if (myInfo.DataSharing.OtherAddressList.Address[0] === "true") {
      $("#baseinfo span[target='share-office-address']").removeClass("hide");
    }
    $("#baseinfo span[target='share-office-address']").attr("original", myInfo.DataSharing.OtherAddressList.Address[0]);
    return $("#baseinfo span[target='photo']").html("<img src='data:image/png;base64," + myInfo.FreshmanPhoto + "' style='width:80px'/>");
  };

  bind_address = function() {
    $("#baseinfo span[target='contact-address']").html("" + (myInfo.MailingAddress.AddressList.Address.ZipCode || '') + (myInfo.MailingAddress.AddressList.Address.County || '') + (myInfo.MailingAddress.AddressList.Address.Town || '') + (myInfo.MailingAddress.AddressList.Address.District || '') + (myInfo.MailingAddress.AddressList.Address.Area || '') + (myInfo.MailingAddress.AddressList.Address.DetailAddress || ''));
    $("#baseinfo span[target='contact-address']").attr("original", "" + (myInfo.MailingAddress.AddressList.Address.ZipCode || '') + (myInfo.MailingAddress.AddressList.Address.County || '') + (myInfo.MailingAddress.AddressList.Address.Town || '') + (myInfo.MailingAddress.AddressList.Address.District || '') + (myInfo.MailingAddress.AddressList.Address.Area || '') + (myInfo.MailingAddress.AddressList.Address.DetailAddress || ''));
    $("#baseinfo td[target='edit-contact-address']").click(function(e) {
      e.preventDefault();
      $(".modal[target='address'] .modal-header h3").html("編輯聯絡地址");
      $(".modal[target='address'] input[target='zipcode']").val(myInfo.MailingAddress.AddressList.Address.ZipCode || "");
      $(".modal[target='address'] input[target='county']").val(myInfo.MailingAddress.AddressList.Address.County || "");
      $(".modal[target='address'] input[target='town']").val(myInfo.MailingAddress.AddressList.Address.Town || "");
      $(".modal[target='address'] input[target='district']").val(myInfo.MailingAddress.AddressList.Address.District || "");
      $(".modal[target='address'] input[target='area']").val(myInfo.MailingAddress.AddressList.Address.Area || "");
      $(".modal[target='address'] input[target='detail']").val(myInfo.MailingAddress.AddressList.Address.DetailAddress || "");
      $(".modal[target='address'] a[target='accept']").attr("edit-type", "MailingAddress");
      return $(".modal[target='address']").modal("show");
    });
    $("#baseinfo span[target='permanent-address']").html("" + (myInfo.PermanentAddress.AddressList.Address.ZipCode || '') + (myInfo.PermanentAddress.AddressList.Address.County || '') + (myInfo.PermanentAddress.AddressList.Address.Town || '') + (myInfo.PermanentAddress.AddressList.Address.District || '') + (myInfo.PermanentAddress.AddressList.Address.Area || '') + (myInfo.PermanentAddress.AddressList.Address.DetailAddress || ''));
    $("#baseinfo span[target='permanent-address']").attr("original", "" + (myInfo.PermanentAddress.AddressList.Address.ZipCode || '') + (myInfo.PermanentAddress.AddressList.Address.County || '') + (myInfo.PermanentAddress.AddressList.Address.Town || '') + (myInfo.PermanentAddress.AddressList.Address.District || '') + (myInfo.PermanentAddress.AddressList.Address.Area || '') + (myInfo.PermanentAddress.AddressList.Address.DetailAddress || ''));
    $("#baseinfo span[target='office-address']").html("" + (myInfo.OtherAddresses.AddressList.Address.ZipCode || '') + (myInfo.OtherAddresses.AddressList.Address.County || '') + (myInfo.OtherAddresses.AddressList.Address.Town || '') + (myInfo.OtherAddresses.AddressList.Address.District || '') + (myInfo.OtherAddresses.AddressList.Address.Area || '') + (myInfo.OtherAddresses.AddressList.Address.DetailAddress || ''));
    $("#baseinfo span[target='office-address']").attr("original", "" + (myInfo.OtherAddresses.AddressList.Address.ZipCode || '') + (myInfo.OtherAddresses.AddressList.Address.County || '') + (myInfo.OtherAddresses.AddressList.Address.Town || '') + (myInfo.OtherAddresses.AddressList.Address.District || '') + (myInfo.OtherAddresses.AddressList.Address.Area || '') + (myInfo.OtherAddresses.AddressList.Address.DetailAddress || ''));
    return $("#baseinfo td[target='edit-office-address']").click(function(e) {
      e.preventDefault();
      $(".modal[target='address'] .modal-header h3").html("編輯公司地址");
      $(".modal[target='address'] input[target='zipcode']").val(myInfo.OtherAddresses.AddressList.Address.ZipCode || "");
      $(".modal[target='address'] input[target='county']").val(myInfo.OtherAddresses.AddressList.Address.County || "");
      $(".modal[target='address'] input[target='town']").val(myInfo.OtherAddresses.AddressList.Address.Town || "");
      $(".modal[target='address'] input[target='district']").val(myInfo.OtherAddresses.AddressList.Address.District || "");
      $(".modal[target='address'] input[target='area']").val(myInfo.OtherAddresses.AddressList.Address.Area || "");
      $(".modal[target='address'] input[target='detail']").val(myInfo.OtherAddresses.AddressList.Address.DetailAddress || "");
      $(".modal[target='address'] a[target='accept']").attr("edit-type", "OtherAddresses");
      return $(".modal[target='address']").modal("show");
    });
  };

  educations = [];

  bind_education = function() {
    return gadget.getContract("emba.student").send({
      service: "default.GetEducationBackground",
      body: "",
      result: function(response, error, http) {
        var items;
        items = [];
        if (response.Result != null) {
          educations = $(response.Result.EducationBackground);
          educations.each(function(index, item) {
            return items.push("<tr>\n	<td>" + (item.IsSharing === "t" ? "<span class='label label-info'><i class='icon-ok icon-white'></i></span>" : "") + "</td>\n	<td>" + item.SchoolName + "</td>\n	<td>" + item.Department + "</td>\n	<td>" + item.Degree + "</td>\n	<td>" + (item.IsTop === "t" ? "<span class='label label-info'><i class='icon-ok icon-white'></i></span>" : "") + "</td>\n	<td style='width:40px'><a href='#' class='btn btn-mini btn-inverse' index='" + index + "' target='edit'>編輯</a></td>\n</tr>");
          });
        }
        $("#baseinfo #education tbody").html(items.join(""));
        return $("#baseinfo #education a[target='edit']").click(function(e) {
          var index;
          e.preventDefault();
          index = parseInt($(this).attr("index"), 10);
          if (educations[index].IsSharing === "t") {
            $(".modal[target='education'] input[target='sharing']").attr("checked", "checked");
          }
          $(".modal[target='education'] input[target='sharing']").attr("original", educations[index].IsSharing);
          $(".modal[target='education'] input[target='schoolname']").val(educations[index].SchoolName);
          $(".modal[target='education'] input[target='schoolname']").attr("original", educations[index].SchoolName);
          $(".modal[target='education'] input[target='department']").val(educations[index].Department);
          $(".modal[target='education'] input[target='department']").attr("original", educations[index].Department);
          $(".modal[target='education'] input[target='degree']").val(educations[index].Degree);
          $(".modal[target='education'] input[target='degree']").attr("original", educations[index].Degree);
          if (educations[index].IsTop === "t") {
            $(".modal[target='education'] input[target='top']").attr("checked", "checked");
          }
          $(".modal[target='education'] input[target='top']").attr("original", educations[index].IsTop);
          $(".modal[target='education'] .modal-header h3").html("編輯學歷");
          $(".modal[target='education'] div[target='confirm-message']").addClass("hide");
          $(".modal[target='education'] a[target='delete']").removeClass("hide");
          $(".modal[target='education'] a[target='save']").attr("edit-type", "update");
          $(".modal[target='education'] a[target='save']").attr("uid", educations[index].UID);
          $(".modal[target='education'] a[target='confirm-accept']").attr("uid", educations[index].UID);
          return $(".modal[target='education']").modal("show");
        });
      }
    });
  };

  experiences = [];

  bind_experience = function() {
    return gadget.getContract("emba.student").send({
      service: "default.GetExperience",
      body: "",
      result: function(response, error, http) {
        var items;
        items = [];
        if (response.Result != null) {
          experiences = $(response.Result.Experience);
          experiences.each(function(index, item) {
            return items.push("<tr>\n	<td>" + (item.IsSharing === "t" ? "<span class='label label-info'><i class='icon-ok icon-white'></i></span>" : "") + "</td>\n	<td>" + item.CompanyName + "</td>\n	<td>" + item.Industry + "</td>\n	<td>" + item.Position + "</td>\n	<td>" + item.DepartmentCategory + "</td>\n	<td>" + item.PostLevel + "</td>\n	<td>" + item.WorkPlace + "</td>\n	<td>" + item.WorkStatus + "</td>\n	<td style='width:40px'><a href='#' class='btn btn-mini btn-inverse' index='" + index + "' target='edit'>編輯</a></td>\n</tr>");
          });
        }
        $("#baseinfo #experience tbody").html(items.join(""));
        return $("#baseinfo #experience a[target='edit']").click(function(e) {
          var index;
          e.preventDefault();
          index = parseInt($(this).attr("index"), 10);
          if (experiences[index].IsSharing === "t") {
            $(".modal[target='experience'] input[target='sharing']").attr("checked", "checked");
          }
          $(".modal[target='experience'] input[target='sharing']").attr("original", experiences[index].IsSharing);
          $(".modal[target='experience'] input[target='companyname']").val(experiences[index].CompanyName);
          $(".modal[target='experience'] input[target='companyname']").attr("original", experiences[index].CompanyName);
          $(".modal[target='experience'] span[target='industry']").html(experiences[index].Industry || "產業別");
          $(".modal[target='experience'] span[target='industry']").attr("original", experiences[index].Industry);
          $(".modal[target='experience'] input[target='position']").val(experiences[index].Position);
          $(".modal[target='experience'] input[target='position']").attr("original", experiences[index].Position);
          $(".modal[target='experience'] span[target='department']").html(experiences[index].DepartmentCategory || "部門類別");
          $(".modal[target='experience'] span[target='department']").attr("original", experiences[index].DepartmentCategory);
          $(".modal[target='experience'] span[target='level']").html(experiences[index].PostLevel || "層級別");
          $(".modal[target='experience'] span[target='level']").attr("original", experiences[index].PostLevel);
          $(".modal[target='experience'] span[target='place']").html(experiences[index].WorkPlace || "工作地點");
          $(".modal[target='experience'] span[target='place']").attr("original", experiences[index].WorkPlace);
          $(".modal[target='experience'] span[target='status']").html(experiences[index].WorkStatus || "工作狀態");
          $(".modal[target='experience'] span[target='status']").attr("original", experiences[index].WorkStatus);
          $(".modal[target='experience'] .modal-header h3").html("編輯經歷");
          $(".modal[target='experience'] div[target='confirm-message']").addClass("hide");
          $(".modal[target='experience'] a[target='delete']").removeClass("hide");
          $(".modal[target='experience'] a[target='save']").attr("edit-type", "update");
          $(".modal[target='experience'] a[target='save']").attr("uid", experiences[index].UID);
          $(".modal[target='experience'] a[target='confirm-accept']").attr("uid", experiences[index].UID);
          return $(".modal[target='experience']").modal("show");
        });
      }
    });
  };

  bind_academic = function() {
    getCurrentCourse();
    getGraduationRequirement();
    return getGraduationSubjectList();
  };

  getCurrentCourse = function() {
    return gadget.getContract("emba.student").send({
      service: "default.GetSemester",
      body: "",
      result: function(response, error, http) {
        var currentSemester;
        if (response.Result != null) {
          currentSemester = {
            SchoolYear: response.Result.SystemConfig.DefaultSchoolYear,
            Semester: response.Result.SystemConfig.DefaultSemester
          };
          return gadget.getContract("emba.student").send({
            service: "default.GetCurrentCourse",
            body: {
              Request: {
                SchoolYear: currentSemester.SchoolYear,
                Semester: currentSemester.Semester
              }
            },
            result: function(response, error, http) {
              if (response.Result != null) {
                return $(response.Result.Course).each(function(index, item) {
                  $("#academic #current-course tbody").append("<tr>\n	<td>" + item.SerialNo + "</td>\n	<td>" + item.SchoolYear + "</td>\n	<td>" + (item.Semester === "0" ? "暑期" : item.Semester) + "</td>\n	<td>" + item.SubjectName + "</td>\n	<td>" + item.ClassName + "</td>\n	<td>" + item.CourseType + "</td>\n	<td>" + (item.IsRequired === "t" ? "必修" : "選修") + "</td>\n	<td>" + item.Credit + "</td>\n	<td course-id=\"" + item.CourseID + "\"></td>\n	<td>" + item.ReportGroup + "</td>\n</tr>");
                  return getCourseTeacherList(item.CourseID);
                });
              }
            }
          });
        }
      }
    });
  };

  getCourseTeacherList = function(course_id) {
    return gadget.getContract("emba.student").send({
      service: "default.GetCourseTeacherList",
      body: {
        Request: {
          CourseID: course_id
        }
      },
      result: function(response, error, http) {
        var teacher_name;
        if (response.Result != null) {
          teacher_name = [];
          $(response.Result.Teacher).each(function() {
            return teacher_name.push(this.TeacherName);
          });
          return $("#academic #current-course td[course-id=" + course_id + "]").html(teacher_name.join(","));
        }
      }
    });
  };

  getGraduationRequirement = function() {
    return gadget.getContract("emba.student").send({
      service: "default.GetGraduationRequirement",
      body: "",
      result: function(response, error, http) {
        var _ref, _ref1, _ref2;
        if (response.Result != null) {
          return $("#academic #credit-info-title").html("畢業應修科目及學分表：系訂必修： " + ((_ref = response.Result.DepartmentCredit) != null ? _ref : "") + " 學分、選修： " + ((_ref1 = response.Result.ElectiveCredit) != null ? _ref1 : "") + " 學分、應修最低畢業學分： " + ((_ref2 = response.Result.RequiredCredit) != null ? _ref2 : ""));
        }
      }
    });
  };

  getGraduationSubjectList = function() {
    return gadget.getContract("emba.student").send({
      service: "default.GetGraduationSubjectList",
      body: "",
      result: function(response, error, http) {
        var items;
        items = [];
        if (response.Result != null) {
          $(response.Result.Subject).each(function(index, item) {
            return items.push("<tr class='info'>\n	<td>" + item.NewSubjectCode + "</td>\n	<td>" + item.SubjectCode + "</td>\n	<td>" + item.ChineseName + "<br/>" + item.EnglishName + "</td>\n	<td>" + item.Credit + "</td>\n	<td>" + item.GroupName + "</td>\n	<td graduation-subject-code='" + item.SubjectCode + "'></td>\n</tr>");
          });
        }
        $("#academic #graduation-info tbody").html(items.join(""));
        return getSubjectSemesterScore();
      }
    });
  };

  getSubjectSemesterScore = function() {
    return gadget.getContract("emba.student").send({
      service: "default.GetSubjectSemesterScore",
      body: "",
      result: function(response, error, http) {
        var items;
        items = [];
        if (response.Result != null) {
          $(response.Result.Score).each(function(index, item) {
            items.push("<tr>\n	<td>" + item.SerialNo + "</td>\n	<td>" + item.SchoolYear + "</td>\n	<td>" + (item.Semester === "0" ? "暑期" : item.Semester) + "</td>\n	<td>" + item.SubjectCode + "</td>\n	<td>" + item.NewSubjectCode + "</td>\n	<td>" + (item.Score === '' && item.SchoolYear === '' && item.Semester === '' ? "" + item.SubjectName + " / " + item.OffsetCourse : item.SubjectName) + "</td>\n	<td>" + (item.IsPass === "t" ? item.Credit : "(" + item.Credit + ")") + "</td>\n	<td>" + (item.Score === '' && item.SchoolYear === '' && item.Semester === '' ? '抵免' : item.Score) + "</td>\n</tr>");
            if (this.IsPass === 't') {
              return $("td[graduation-subject-code='" + this.SubjectCode + "']").html('已取得學分');
            }
          });
          return $("#academic #subject-semester-score tbody").html(items.join(""));
        }
      }
    });
  };

  query_absence = function() {
    return gadget.getContract("emba.student").send({
      service: "default.GetAbsence",
      body: {
        Request: {
          SchoolYear: $("#absence input[target='schoolYear']").val(),
          Semester: $("#absence span[target='semester']").attr("value")
        }
      },
      result: function(response, error, http) {
        var items;
        items = [];
        if (response.Result != null) {
          $(response.Result.Absence).each(function(index, item) {
            return items.push("<tr>\n	<td>" + item.SchoolYear + "</td>\n	<td>" + item.Semester + "</td>\n	<td>" + item.CourseName + "</td>\n	<td>" + item.SubjectCode + "</td>\n	<td>" + (item.StartTime.substr(0, 10)) + "</td>\n	<td>" + (item.StartTime.substr(11, 5)) + "</td>\n	<td>" + item.MakeUpDescription + "</td>\n</tr>");
          });
        }
        return $("#absence #absence-detail tbody").html(items.join(""));
      }
    });
  };

  bind_payment = function() {
    return gadget.getContract("emba.student").send({
      service: "default.GetPaymentHistory",
      body: "",
      result: function(response, error, http) {
        var items;
        items = [];
        if (response.Result != null) {
          $(response.Result.PaymentHistory).each(function(index, item) {
            if (item.IsPaied === "1") {
              return items.push("<tr>\n	<td>" + item.SchoolYear + "</td>\n	<td>" + (item.Semester === "0" ? "暑假" : "第 " + item.Semester + " 學期") + "</td>\n	<td>已繳費</td>\n	<td>" + (item.ModifiedDate !== "" ? item.ModifiedDate.substr(0, 10) : "") + "</td>\n</tr>");
            }
          });
        }
        return $("#payment #payment-detail tbody").html(items.join(""));
      }
    });
  };

}).call(this);
